# æ‰“å¡ç³»ç»Ÿæ•°æ®æ¨¡å‹æ–‡æ¡£

<cite>
**æœ¬æ–‡æ¡£ä¸­å¼•ç”¨çš„æ–‡ä»¶**
- [src/types/checkin.ts](file://src/types/checkin.ts)
- [src/utils/checkinService.ts](file://src/utils/checkinService.ts)
- [supabase_checkin_tables.sql](file://supabase_checkin_tables.sql)
- [src/components/CheckinComponents.tsx](file://src/components/CheckinComponents.tsx)
- [src/components/CheckinPage.tsx](file://src/components/CheckinPage.tsx)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [æ ¸å¿ƒæ•°æ®æ¨¡å‹æ¦‚è¿°](#æ ¸å¿ƒæ•°æ®æ¨¡å‹æ¦‚è¿°)
3. [CheckinItem æ•°æ®æ¨¡å‹](#checkinitem-æ•°æ®æ¨¡å‹)
4. [CheckinRecord æ•°æ®æ¨¡å‹](#checkinrecord-æ•°æ®æ¨¡å‹)
5. [CheckinBlog æ•°æ®æ¨¡å‹](#checkinblog-æ•°æ®æ¨¡å‹)
6. [CheckinStats æ•°æ®æ¨¡å‹](#checkinstats-æ•°æ®æ¨¡å‹)
7. [æ•°æ®æ¨¡å‹å…³ç³»å›¾](#æ•°æ®æ¨¡å‹å…³ç³»å›¾)
8. [æœåŠ¡æ¥å£ä¸CRUDæ“ä½œ](#æœåŠ¡æ¥å£ä¸crudæ“ä½œ)
9. [æ•°æ®éªŒè¯ä¸çº¦æŸ](#æ•°æ®éªŒè¯ä¸çº¦æŸ)
10. [å‰ç«¯ç»„ä»¶é›†æˆ](#å‰ç«¯ç»„ä»¶é›†æˆ)
11. [æ€§èƒ½ä¼˜åŒ–è€ƒè™‘](#æ€§èƒ½ä¼˜åŒ–è€ƒè™‘)
12. [å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
13. [æ‰©å±•æŒ‡å—](#æ‰©å±•æŒ‡å—)

## ç®€ä»‹

æ‰“å¡ç³»ç»Ÿæ˜¯ä¸€ä¸ªå®Œæ•´çš„ä¸ªäººæˆé•¿è¿½è¸ªå¹³å°ï¼Œé€šè¿‡å››ä¸ªæ ¸å¿ƒæ•°æ®æ¨¡å‹å®ç°äº†ä»åŸºç¡€æ‰“å¡åˆ°æ·±åº¦æ•°æ®åˆ†æçš„å®Œæ•´åŠŸèƒ½é“¾ã€‚æœ¬æ–‡æ¡£è¯¦ç»†é˜è¿°äº†CheckinItemã€CheckinRecordã€CheckinBlogå’ŒCheckinStatsç­‰æ¥å£çš„ç»“æ„å®šä¹‰ã€ä¸šåŠ¡é€»è¾‘å’Œå®é™…åº”ç”¨åœºæ™¯ã€‚

## æ ¸å¿ƒæ•°æ®æ¨¡å‹æ¦‚è¿°

æ‰“å¡ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ•°æ®æ¶æ„ï¼Œæ¯ä¸ªæ¨¡å‹éƒ½æœ‰æ˜ç¡®çš„èŒè´£å’Œä¸šåŠ¡è¾¹ç•Œï¼š

```mermaid
graph TB
subgraph "æ ¸å¿ƒæ•°æ®æ¨¡å‹"
CI[CheckinItem<br/>æ‰“å¡é¡¹ç›®]
CR[CheckinRecord<br/>æ‰“å¡è®°å½•]
CB[CheckinBlog<br/>æ‰“å¡åšå®¢]
CS[CheckinStats<br/>ç»Ÿè®¡æ•°æ®]
end
subgraph "è¾…åŠ©ç±»å‹"
CC[CheckinCategory<br/>åˆ†ç±»]
CM[CheckinMood<br/>å¿ƒæƒ…çŠ¶æ€]
CD[CheckinCalendarDay<br/>æ—¥å†æ•°æ®]
end
CI --> CR
CR --> CB
CI --> CS
CR --> CS
CB --> CS
CI -.-> CC
CR -.-> CM
CS -.-> CD
```

**å›¾è¡¨æ¥æº**
- [src/types/checkin.ts](file://src/types/checkin.ts#L1-L284)

## CheckinItem æ•°æ®æ¨¡å‹

CheckinItemæ˜¯æ‰“å¡ç³»ç»Ÿçš„æ ¸å¿ƒå®ä½“ï¼Œä»£è¡¨ç”¨æˆ·åˆ›å»ºçš„æ‰“å¡é¡¹ç›®ã€‚æ¯ä¸ªé¡¹ç›®éƒ½æœ‰æ˜ç¡®çš„ç›®æ ‡ã€åˆ†ç±»å’Œä¸ªæ€§åŒ–é…ç½®ã€‚

### å­—æ®µå®šä¹‰ä¸ä¸šåŠ¡å«ä¹‰

```typescript
export interface CheckinItem {
  id: number | string;                    // å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œæ”¯æŒæ•°å­—å’Œå­—ç¬¦ä¸²
  title: string;                          // é¡¹ç›®åç§°ï¼Œå¿…å¡«å­—æ®µ
  description?: string;                   // é¡¹ç›®æè¿°ï¼Œå¯é€‰å­—æ®µ
  icon: string;                           // å›¾æ ‡emojiï¼Œè¡¨ç¤ºé¡¹ç›®ç±»å‹
  color: string;                          // ä¸»é¢˜é¢œè‰²ï¼Œåå…­è¿›åˆ¶æ ¼å¼
  category: CheckinCategory;              // åˆ†ç±»ï¼Œæšä¸¾ç±»å‹
  target_type: 'daily' | 'weekly' | 'custom'; // ç›®æ ‡ç±»å‹
  target_count: number;                   // ç›®æ ‡æ¬¡æ•°ï¼Œå¿…é¡»å¤§äº0
  created_at: Date;                       // åˆ›å»ºæ—¶é—´
  updated_at: Date;                       // æ›´æ–°æ—¶é—´
  user_id: string;                        // ç”¨æˆ·IDï¼Œå¤–é”®å…³è”
  is_active: boolean;                     // æ˜¯å¦æ¿€æ´»çŠ¶æ€
}
```

### æ•°æ®ç±»å‹ä¸çº¦æŸ

- **id**: æ”¯æŒæ•°å­—å’Œå­—ç¬¦ä¸²ç±»å‹ï¼Œä¾¿äºä¸åŒæ•°æ®åº“çš„å…¼å®¹æ€§
- **title**: é•¿åº¦é™åˆ¶ç”±æ•°æ®åº“å†³å®šï¼Œå»ºè®®ä¸è¶…è¿‡255å­—ç¬¦
- **icon**: ä½¿ç”¨emojiå­—ç¬¦ï¼Œæ”¯æŒå¸¸è§çš„è¡¨æƒ…ç¬¦å·
- **color**: åå…­è¿›åˆ¶é¢œè‰²å€¼ï¼Œç¡®ä¿åœ¨UIä¸­æ­£ç¡®æ¸²æŸ“
- **category**: æšä¸¾ç±»å‹ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- **target_type**: å›ºå®šä¸‰ç§ç±»å‹ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒçš„ç›®æ ‡æ¨¡å¼
- **target_count**: æ­£æ•´æ•°ï¼Œæœ€å°å€¼ä¸º1
- **is_active**: è½¯åˆ é™¤æœºåˆ¶ï¼Œä¸å½±å“å†å²æ•°æ®

### åˆ†ç±»ä½“ç³»

ç³»ç»Ÿæä¾›äº†å…«ä¸ªæ ‡å‡†åŒ–çš„åˆ†ç±»ï¼š

```typescript
export type CheckinCategory = 
  | 'health'      // å¥åº· - ğŸ¥
  | 'fitness'     // è¿åŠ¨ - ğŸ’ª
  | 'learning'    // å­¦ä¹  - ğŸ“š
  | 'habit'       // ä¹ æƒ¯ - â­
  | 'work'        // å·¥ä½œ - ğŸ’¼
  | 'hobby'       // çˆ±å¥½ - ğŸ¨
  | 'social'      // ç¤¾äº¤ - ğŸ‘¥
  | 'other';      // å…¶ä»– - ğŸ“
```

**ç« èŠ‚æ¥æº**
- [src/types/checkin.ts](file://src/types/checkin.ts#L5-L18)

## CheckinRecord æ•°æ®æ¨¡å‹

CheckinRecordè®°å½•ç”¨æˆ·çš„å®é™…æ‰“å¡è¡Œä¸ºï¼ŒåŒ…å«æ—¶é—´æˆ³ã€å¤‡æ³¨å’Œé™„åŠ ä¿¡æ¯ã€‚

### å­—æ®µå®šä¹‰ä¸ä¸šåŠ¡é€»è¾‘

```typescript
export interface CheckinRecord {
  id: number | string;
  checkin_item_id: number | string;       // å…³è”çš„æ‰“å¡é¡¹ç›®ID
  user_id: string;                        // ç”¨æˆ·ID
  checked_at: Date;                       // æ‰“å¡æ—¶é—´ï¼Œç²¾ç¡®åˆ°ç§’
  note?: string;                          // æ‰“å¡å¤‡æ³¨ï¼Œå¯é€‰
  mood?: CheckinMood;                     // å¿ƒæƒ…çŠ¶æ€ï¼Œå¯é€‰
  location?: string;                      // åœ°ç‚¹ï¼Œå¯é€‰
  photo_url?: string;                     // ç…§ç‰‡URLï¼Œå¯é€‰
  created_at: Date;                       // è®°å½•åˆ›å»ºæ—¶é—´
}
```

### å¿ƒæƒ…çŠ¶æ€ä½“ç³»

```typescript
export type CheckinMood = 
  | 'excellent'   // ğŸ˜„ è¶…æ£’
  | 'good'        // ğŸ˜Š ä¸é”™  
  | 'neutral'     // ğŸ˜ ä¸€èˆ¬
  | 'tired'       // ğŸ˜´ ç–²æƒ«
  | 'stressed';   // ğŸ˜° ç„¦è™‘
```

### å…³è”å…³ç³»

CheckinRecordä¸CheckinItemä¹‹é—´å­˜åœ¨ä¸€å¯¹ä¸€çš„å…³ç³»ï¼š
- æ¯æ¡è®°å½•å¿…é¡»å…³è”ä¸€ä¸ªæœ‰æ•ˆçš„CheckinItem
- é€šè¿‡checkin_item_idå»ºç«‹å¤–é”®çº¦æŸ
- æ”¯æŒå¤šå¯¹ä¸€å…³ç³»ï¼Œä¸€ä¸ªé¡¹ç›®å¯ä»¥æœ‰å¤šä¸ªè®°å½•

**ç« èŠ‚æ¥æº**
- [src/types/checkin.ts](file://src/types/checkin.ts#L20-L32)

## CheckinBlog æ•°æ®æ¨¡å‹

CheckinBlogæ˜¯é«˜çº§åŠŸèƒ½æ¨¡å—ï¼Œå…è®¸ç”¨æˆ·å°†æ‰“å¡è®°å½•æ•´åˆä¸ºå¸¦æœ‰ä¸°å¯Œå†…å®¹çš„æ–‡ç« ã€‚

### å­—æ®µå®šä¹‰ä¸æ‰©å±•åŠŸèƒ½

```typescript
export interface CheckinBlog {
  id: number | string;
  title: string;                          // æ–‡ç« æ ‡é¢˜
  content: string;                        // Markdownæ ¼å¼çš„å†…å®¹
  cover_image_url?: string;               // å°é¢å›¾ç‰‡URL
  location?: string;                      // å‘å¸ƒåœ°ç‚¹
  tags: string[];                         // æ ‡ç­¾æ•°ç»„
  checkin_records: number[];              // å…³è”çš„æ‰“å¡è®°å½•IDæ•°ç»„
  mood: CheckinMood;                      // å½“å‰å¿ƒæƒ…
  weather?: string;                       // å¤©æ°”ä¿¡æ¯
  created_at: Date;                       // åˆ›å»ºæ—¶é—´
  updated_at: Date;                       // æ›´æ–°æ—¶é—´
  user_id: string;                        // ç”¨æˆ·ID
  is_public: boolean;                     // æ˜¯å¦å…¬å¼€
  like_count: number;                     // ç‚¹èµæ•°
  view_count: number;                     // æµè§ˆæ•°
}
```

### åšå®¢ç‰¹æ€§

- **å†…å®¹å¯Œåª’ä½“**: æ”¯æŒMarkdownæ ¼å¼ï¼Œä¾¿äºç¼–å†™é«˜è´¨é‡å†…å®¹
- **æ ‡ç­¾ç³»ç»Ÿ**: ä½¿ç”¨æ•°ç»„å­˜å‚¨æ ‡ç­¾ï¼Œæ”¯æŒå…¨æ–‡æœç´¢ä¼˜åŒ–
- **å…³è”æœºåˆ¶**: é€šè¿‡checkin_recordså­—æ®µå…³è”å¤šä¸ªæ‰“å¡è®°å½•
- **ç¤¾äº¤åŠŸèƒ½**: åŒ…å«ç‚¹èµå’Œæµè§ˆè®¡æ•°ï¼Œæ”¯æŒç¤¾åŒºäº’åŠ¨
- **éšç§æ§åˆ¶**: is_publicå­—æ®µæ§åˆ¶å†…å®¹å¯è§æ€§

### æ•°æ®å®Œæ•´æ€§çº¦æŸ

æ•°æ®åº“å±‚é¢è®¾ç½®äº†ä¸¥æ ¼çš„çº¦æŸï¼š
- tagså­—æ®µä½¿ç”¨GINç´¢å¼•ï¼Œæ”¯æŒé«˜æ•ˆçš„æ•°ç»„æŸ¥è¯¢
- moodå­—æ®µæœ‰æšä¸¾éªŒè¯ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- like_countå’Œview_countæœ‰éè´Ÿçº¦æŸ

**ç« èŠ‚æ¥æº**
- [src/types/checkin.ts](file://src/types/checkin.ts#L39-L56)

## CheckinStats æ•°æ®æ¨¡å‹

CheckinStatsæä¾›ç»¼åˆæ€§çš„æ•°æ®åˆ†æï¼Œå¸®åŠ©ç”¨æˆ·äº†è§£è‡ªå·±çš„æ‰“å¡ä¹ æƒ¯å’Œè¿›æ­¥æƒ…å†µã€‚

### å­—æ®µå®šä¹‰ä¸ç»Ÿè®¡ç»´åº¦

```typescript
export interface CheckinStats {
  total_items: number;                    // æ€»æ‰“å¡é¡¹ç›®æ•°
  active_items: number;                   // æ´»è·ƒé¡¹ç›®æ•°
  total_records: number;                  // æ€»æ‰“å¡æ¬¡æ•°
  today_records: number;                  // ä»Šæ—¥æ‰“å¡æ¬¡æ•°
  week_records: number;                   // æœ¬å‘¨æ‰“å¡æ¬¡æ•°
  month_records: number;                  // æœ¬æœˆæ‰“å¡æ¬¡æ•°
  streak_days: number;                    // è¿ç»­æ‰“å¡å¤©æ•°
  longest_streak: number;                 // æœ€é•¿è¿ç»­å¤©æ•°
  completion_rate: number;                // å®Œæˆç‡ç™¾åˆ†æ¯”
  favorite_category: CheckinCategory;     // æœ€å–œæ¬¢çš„åˆ†ç±»
  total_blogs: number;                    // Blogæ€»æ•°
  mood_distribution: Record<CheckinMood, number>; // å¿ƒæƒ…åˆ†å¸ƒ
  category_distribution: Record<CheckinCategory, number>; // åˆ†ç±»åˆ†å¸ƒ
}
```

### ç»Ÿè®¡ç®—æ³•

ç³»ç»Ÿå®ç°äº†å¤æ‚çš„ç»Ÿè®¡è®¡ç®—ï¼š

```typescript
// è¿ç»­å¤©æ•°è®¡ç®—
export const getStreakDays = (records: CheckinRecord[]): number => {
  if (records.length === 0) return 0;
  
  const today = new Date();
  let streak = 0;
  let currentDate = new Date(today);
  
  while (true) {
    const dateStr = currentDate.toISOString().split('T')[0];
    const hasRecord = records.some(record => 
      record.checked_at.toISOString().split('T')[0] === dateStr
    );
    
    if (hasRecord) {
      streak++;
      currentDate.setDate(currentDate.getDate() - 1);
    } else {
      break;
    }
  }
  
  return streak;
};

// å®Œæˆç‡è®¡ç®—
export const getCompletionRate = (
  items: CheckinItem[], 
  records: CheckinRecord[], 
  timeRange: { start: Date; end: Date }
): number => {
  if (items.length === 0) return 0;
  
  const totalTargets = items.reduce((sum, item) => {
    const days = Math.ceil((timeRange.end.getTime() - timeRange.start.getTime()) / (1000 * 60 * 60 * 24));
    return sum + (item.target_type === 'daily' ? days * item.target_count : item.target_count);
  }, 0);
  
  const completedCount = records.filter(record => 
    record.checked_at >= timeRange.start && record.checked_at <= timeRange.end
  ).length;
  
  return totalTargets > 0 ? Math.round((completedCount / totalTargets) * 100) : 0;
};
```

**ç« èŠ‚æ¥æº**
- [src/types/checkin.ts](file://src/types/checkin.ts#L58-L77)

## æ•°æ®æ¨¡å‹å…³ç³»å›¾

```mermaid
erDiagram
CHECKIN_ITEMS {
bigint id PK
varchar title
text description
varchar icon
varchar color
varchar category
varchar target_type
integer target_count
timestamp created_at
timestamp updated_at
uuid user_id FK
boolean is_active
}
CHECKIN_RECORDS {
bigint id PK
bigint checkin_item_id FK
uuid user_id FK
timestamp checked_at
text note
varchar mood
varchar location
text photo_url
timestamp created_at
}
CHECKIN_BLOGS {
bigint id PK
varchar title
text content
text cover_image_url
varchar location
text[] tags
bigint[] checkin_records
varchar mood
varchar weather
timestamp created_at
timestamp updated_at
uuid user_id FK
boolean is_public
integer like_count
integer view_count
}
AUTH_USERS {
uuid id PK
jsonb profile_data
timestamp created_at
}
CHECKIN_ITEMS ||--o{ CHECKIN_RECORDS : "has"
CHECKIN_ITEMS ||--|| CHECKIN_BLOGS : "can be part of"
CHECKIN_RECORDS ||--o{ CHECKIN_BLOGS : "can be aggregated into"
AUTH_USERS ||--o{ CHECKIN_ITEMS : "owns"
AUTH_USERS ||--o{ CHECKIN_RECORDS : "performs"
AUTH_USERS ||--o{ CHECKIN_BLOGS : "writes"
```

**å›¾è¡¨æ¥æº**
- [supabase_checkin_tables.sql](file://supabase_checkin_tables.sql#L1-L284)

## æœåŠ¡æ¥å£ä¸CRUDæ“ä½œ

CheckinServiceæ¥å£å®šä¹‰äº†å®Œæ•´çš„æ•°æ®è®¿é—®å±‚ï¼Œæ”¯æŒæ‰€æœ‰å¿…è¦çš„CRUDæ“ä½œã€‚

### æœåŠ¡æ¥å£æ¦‚è§ˆ

```typescript
export interface CheckinService {
  // æ‰“å¡é¡¹ç›®ç®¡ç†
  getCheckinItems(): Promise<CheckinItem[]>;
  createCheckinItem(item: Omit<CheckinItem, 'id' | 'created_at' | 'updated_at' | 'user_id'>): Promise<CheckinItem>;
  updateCheckinItem(id: number | string, updates: Partial<CheckinItem>): Promise<CheckinItem>;
  deleteCheckinItem(id: number | string): Promise<void>;

  // æ‰“å¡è®°å½•ç®¡ç†
  getCheckinRecords(itemId?: number | string, dateRange?: { start: Date; end: Date }): Promise<CheckinRecord[]>;
  createCheckinRecord(record: Omit<CheckinRecord, 'id' | 'created_at' | 'user_id'>): Promise<CheckinRecord>;
  updateCheckinRecord(id: number | string, updates: Partial<CheckinRecord>): Promise<CheckinRecord>;
  deleteCheckinRecord(id: number | string): Promise<void>;

  // ç»Ÿè®¡æ•°æ®
  getCheckinStats(timeRange?: { start: Date; end: Date }): Promise<CheckinStats>;
  getCheckinCalendar(month: Date): Promise<CheckinCalendarDay[]>;

  // Blogç®¡ç†
  getBlogs(filters?: BlogFilters): Promise<CheckinBlog[]>;
  getBlogById(id: number | string): Promise<CheckinBlog>;
  createBlog(blog: Omit<CheckinBlog, 'id' | 'created_at' | 'updated_at' | 'user_id' | 'like_count' | 'view_count'>): Promise<CheckinBlog>;
  updateBlog(id: number | string, updates: Partial<CheckinBlog>): Promise<CheckinBlog>;
  deleteBlog(id: number | string): Promise<void>;
  likeBlog(id: number | string): Promise<void>;
}
```

### å®é™…ä½¿ç”¨ç¤ºä¾‹

#### åˆ›å»ºæ‰“å¡é¡¹ç›®

```typescript
const newItem = await checkinService.createCheckinItem({
  title: "æ¯æ—¥é˜…è¯»",
  description: "æ¯å¤©é˜…è¯»è‡³å°‘30åˆ†é’Ÿ",
  icon: "ğŸ“š",
  color: "#8B5CF6",
  category: "learning",
  target_type: "daily",
  target_count: 1,
  is_active: true
});
```

#### åˆ›å»ºæ‰“å¡è®°å½•

```typescript
const newRecord = await checkinService.createCheckinRecord({
  checkin_item_id: newItem.id,
  note: "ä»Šå¤©è¯»äº†ã€ŠJavaScriptæƒå¨æŒ‡å—ã€‹ç¬¬5ç« ",
  mood: "good",
  location: "ä¹¦æˆ¿"
});
```

#### è·å–ç»Ÿè®¡æ•°æ®

```typescript
const stats = await checkinService.getCheckinStats({
  start: new Date("2024-01-01"),
  end: new Date("2024-01-31")
});

console.log(`æœ¬æœˆå®Œæˆç‡: ${stats.completion_rate}%`);
console.log(`æœ€é•¿è¿ç»­æ‰“å¡: ${stats.longest_streak}å¤©`);
```

**ç« èŠ‚æ¥æº**
- [src/types/checkin.ts](file://src/types/checkin.ts#L152-L177)
- [src/utils/checkinService.ts](file://src/utils/checkinService.ts#L1-L760)

## æ•°æ®éªŒè¯ä¸çº¦æŸ

### æ•°æ®åº“çº¦æŸ

Supabaseæ•°æ®åº“è®¾ç½®äº†å¤šå±‚æ¬¡çš„çº¦æŸä¿è¯æ•°æ®å®Œæ•´æ€§ï¼š

```sql
-- æ‰“å¡é¡¹ç›®çº¦æŸ
CONSTRAINT valid_category CHECK (category IN ('health', 'fitness', 'learning', 'habit', 'work', 'hobby', 'social', 'other'))
CONSTRAINT valid_target_type CHECK (target_type IN ('daily', 'weekly', 'custom'))
CONSTRAINT valid_target_count CHECK (target_count > 0)

-- æ‰“å¡è®°å½•çº¦æŸ
CONSTRAINT valid_mood CHECK (mood IN ('excellent', 'good', 'neutral', 'tired', 'stressed') OR mood IS NULL)

-- Blogçº¦æŸ
CONSTRAINT valid_mood CHECK (mood IN ('excellent', 'good', 'neutral', 'tired', 'stressed'))
CONSTRAINT valid_like_count CHECK (like_count >= 0)
CONSTRAINT valid_view_count CHECK (view_count >= 0)
```

### å‰ç«¯éªŒè¯

```typescript
// è¡¨å•éªŒè¯ç¤ºä¾‹
const validateCheckinItem = (item: Partial<CheckinItem>): string[] => {
  const errors: string[] = [];
  
  if (!item.title?.trim()) {
    errors.push("é¡¹ç›®åç§°ä¸èƒ½ä¸ºç©º");
  }
  
  if (item.target_count && item.target_count <= 0) {
    errors.push("ç›®æ ‡æ¬¡æ•°å¿…é¡»å¤§äº0");
  }
  
  if (!Object.values(CheckinCategory).includes(item.category as CheckinCategory)) {
    errors.push("æ— æ•ˆçš„åˆ†ç±»");
  }
  
  return errors;
};
```

### ç±»å‹å®‰å…¨

TypeScriptæä¾›äº†ç¼–è¯‘æ—¶çš„ç±»å‹æ£€æŸ¥ï¼š

```typescript
// ä½¿ç”¨Partialç¡®ä¿åªä¼ é€’éœ€è¦æ›´æ–°çš„å­—æ®µ
const updateItem = async (id: number, updates: Partial<CheckinItem>) => {
  const result = await checkinService.updateCheckinItem(id, updates);
  // ç¼–è¯‘æ—¶æ£€æŸ¥updatesæ˜¯å¦ç¬¦åˆCheckinItemçš„å­—æ®µè¦æ±‚
};
```

**ç« èŠ‚æ¥æº**
- [supabase_checkin_tables.sql](file://supabase_checkin_tables.sql#L10-L20)

## å‰ç«¯ç»„ä»¶é›†æˆ

### ç»„ä»¶Propsæ¥å£

ç³»ç»Ÿä¸ºæ¯ä¸ªæ•°æ®æ¨¡å‹éƒ½å®šä¹‰äº†å¯¹åº”çš„Reactç»„ä»¶Propsæ¥å£ï¼š

```typescript
export interface CheckinItemCardProps {
  item: CheckinItem;
  todayRecord?: CheckinRecord;
  onCheckin: (itemId: number | string, note?: string, mood?: CheckinMood) => void;
  onEditItem: (item: CheckinItem) => void;
  onDeleteItem: (itemId: number | string) => void;
}

export interface BlogCardProps {
  blog: CheckinBlog;
  onBlogClick: (blog: CheckinBlog) => void;
  onLike: (blogId: number | string) => void;
  onDelete?: (blogId: number | string) => void;
}

export interface CreateBlogProps {
  checkinRecords: CheckinRecord[];
  onClose: () => void;
  onSave: (blog: Omit<CheckinBlog, 'id' | 'created_at' | 'updated_at' | 'user_id' | 'like_count' | 'view_count'>) => void;
}
```

### ç»„ä»¶ä½¿ç”¨ç¤ºä¾‹

```typescript
// CheckinItemå¡ç‰‡ç»„ä»¶
<CheckinItemCard
  item={item}
  todayRecord={todayRecord}
  onCheckin={handleCheckin}
  onEditItem={handleEditItem}
  onDeleteItem={handleDeleteItem}
/>

// Blogåˆ—è¡¨ç»„ä»¶
<BlogList
  blogs={blogs}
  onBlogClick={handleBlogClick}
  onCreateBlog={handleCreateBlog}
  onFilterChange={handleFilterChange}
  filters={filters}
/>
```

### çŠ¶æ€ç®¡ç†

ç»„ä»¶å†…éƒ¨ç»´æŠ¤å±€éƒ¨çŠ¶æ€ï¼š

```typescript
const [formData, setFormData] = useState({
  title: '',
  description: '',
  icon: 'ğŸ“',
  color: '#3B82F6',
  category: 'other' as CheckinCategory,
  target_type: 'daily' as 'daily' | 'weekly' | 'custom',
  target_count: 1,
  is_active: true
});
```

**ç« èŠ‚æ¥æº**
- [src/types/checkin.ts](file://src/types/checkin.ts#L95-L150)
- [src/components/CheckinComponents.tsx](file://src/components/CheckinComponents.tsx#L1-L496)

## æ€§èƒ½ä¼˜åŒ–è€ƒè™‘

### æ•°æ®åº“ç´¢å¼•ç­–ç•¥

```sql
-- æ‰“å¡é¡¹ç›®ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_checkin_items_user_id ON checkin_items(user_id);
CREATE INDEX IF NOT EXISTS idx_checkin_items_category ON checkin_items(category);
CREATE INDEX IF NOT EXISTS idx_checkin_items_active ON checkin_items(is_active);

-- æ‰“å¡è®°å½•ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_checkin_records_user_id ON checkin_records(user_id);
CREATE INDEX IF NOT EXISTS idx_checkin_records_item_id ON checkin_records(checkin_item_id);
CREATE INDEX IF NOT EXISTS idx_checkin_records_checked_at ON checkin_records(checked_at);
CREATE INDEX IF NOT EXISTS idx_checkin_records_mood ON checkin_records(mood);

-- Blogç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_checkin_blogs_user_id ON checkin_blogs(user_id);
CREATE INDEX IF NOT EXISTS idx_checkin_blogs_created_at ON checkin_blogs(created_at);
CREATE INDEX IF NOT EXISTS idx_checkin_blogs_mood ON checkin_blogs(mood);
CREATE INDEX IF NOT EXISTS idx_checkin_blogs_tags ON checkin_blogs USING GIN(tags);
CREATE INDEX IF NOT EXISTS idx_checkin_blogs_public ON checkin_blogs(is_public);
```

### ç¼“å­˜æœºåˆ¶

CheckinDataServiceå®ç°äº†æ™ºèƒ½ç¼“å­˜ï¼š

```typescript
private cache = {
  checkinItems: [] as CheckinItem[],
  checkinRecords: [] as CheckinRecord[],
  blogs: [] as CheckinBlog[],
  lastSyncTime: null as Date | null
};

async getCheckinItems(): Promise<CheckinItem[]> {
  try {
    // ä»æ•°æ®åº“è·å–æœ€æ–°æ•°æ®
    const { data, error } = await supabase
      .from('checkin_items')
      .select('*')
      .eq('is_active', true)
      .order('created_at', { ascending: false });
    
    // æ›´æ–°ç¼“å­˜
    this.cache.checkinItems = items;
    this.cache.lastSyncTime = new Date();
    
    return items;
  } catch (error) {
    // è¿”å›ç¼“å­˜æ•°æ®ä½œä¸ºå›é€€
    return this.cache.checkinItems;
  }
}
```

### æŸ¥è¯¢ä¼˜åŒ–

```typescript
// ä½¿ç”¨æ¡ä»¶æŸ¥è¯¢é¿å…å…¨è¡¨æ‰«æ
async getCheckinRecords(itemId?: number | string, dateRange?: { start: Date; end: Date }): Promise<CheckinRecord[]> {
  let query = supabase
    .from('checkin_records')
    .select('*')
    .order('checked_at', { ascending: false });

  if (itemId) {
    query = query.eq('checkin_item_id', itemId);
  }

  if (dateRange) {
    query = query
      .gte('checked_at', dateRange.start.toISOString())
      .lte('checked_at', dateRange.end.toISOString());
  }

  const { data, error } = await query;
  // ...
}
```

**ç« èŠ‚æ¥æº**
- [supabase_checkin_tables.sql](file://supabase_checkin_tables.sql#L64-L92)
- [src/utils/checkinService.ts](file://src/utils/checkinService.ts#L15-L30)

## å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### ç±»å‹é”™è¯¯

#### é—®é¢˜ï¼šæ—¥æœŸç±»å‹è½¬æ¢é”™è¯¯
```typescript
// é”™è¯¯ï¼šç›´æ¥èµ‹å€¼ISOå­—ç¬¦ä¸²ç»™Dateç±»å‹
const wrongDate = "2024-01-01"; // stringç±»å‹
const correctDate = new Date("2024-01-01"); // Dateç±»å‹
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// åœ¨æœåŠ¡å±‚ç»Ÿä¸€å¤„ç†æ—¥æœŸè½¬æ¢
const records: CheckinRecord[] = data.map(record => ({
  ...record,
  checked_at: new Date(record.checked_at),
  created_at: new Date(record.created_at)
}));
```

#### é—®é¢˜ï¼šæšä¸¾ç±»å‹ä¸åŒ¹é…
```typescript
// é”™è¯¯ï¼šä½¿ç”¨ä¸å­˜åœ¨çš„åˆ†ç±»
const invalidItem = {
  category: "invalid_category" // ä¸åœ¨CheckinCategoryæšä¸¾ä¸­
};
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// ä½¿ç”¨ç±»å‹æ–­è¨€å’ŒéªŒè¯
const safeCategory = category as CheckinCategory;
if (!Object.values(CheckinCategory).includes(safeCategory)) {
  throw new Error("Invalid category");
}
```

### æ•°æ®ä¸€è‡´æ€§é—®é¢˜

#### é—®é¢˜ï¼šè½¯åˆ é™¤å¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´
```typescript
// åˆ é™¤é¡¹ç›®åï¼Œç›¸å…³è®°å½•ä»ç„¶å­˜åœ¨
await checkinService.deleteCheckinItem(itemId);
// checkin_recordsè¡¨ä¸­ä»æœ‰æ—§æ•°æ®
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// ä½¿ç”¨CASCADEåˆ é™¤ç¡®ä¿æ•°æ®å®Œæ•´æ€§
CREATE TABLE checkin_records (
  id BIGSERIAL PRIMARY KEY,
  checkin_item_id BIGINT REFERENCES checkin_items(id) ON DELETE CASCADE,
  // ...
);
```

### æ€§èƒ½é—®é¢˜

#### é—®é¢˜ï¼šå¤§é‡æ•°æ®æŸ¥è¯¢å¯¼è‡´æ€§èƒ½ä¸‹é™
```typescript
// é”™è¯¯ï¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®
const allRecords = await checkinService.getCheckinRecords(); // å¯èƒ½è¿”å›æ•°åƒæ¡è®°å½•
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// ä½¿ç”¨åˆ†é¡µå’ŒèŒƒå›´æŸ¥è¯¢
const paginatedRecords = await checkinService.getCheckinRecords(undefined, {
  start: new Date("2024-01-01"),
  end: new Date("2024-01-31")
});
```

### å‰ç«¯çŠ¶æ€åŒæ­¥é—®é¢˜

#### é—®é¢˜ï¼šç»„ä»¶çŠ¶æ€ä¸æœåŠ¡å™¨çŠ¶æ€ä¸åŒæ­¥
```typescript
// é—®é¢˜ï¼šæœ¬åœ°çŠ¶æ€æœªåŠæ—¶æ›´æ–°
const [items, setItems] = useState<CheckinItem[]>([]);
// ç”¨æˆ·åˆ›å»ºæ–°é¡¹ç›®åï¼Œç•Œé¢æœªåˆ·æ–°
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// ä½¿ç”¨äº‹ä»¶é©±åŠ¨çš„çŠ¶æ€æ›´æ–°
const handleCreateItem = async (item: CheckinItem) => {
  await checkinService.createCheckinItem(item);
  // é‡æ–°åŠ è½½æ•°æ®ä»¥ç¡®ä¿çŠ¶æ€åŒæ­¥
  const updatedItems = await checkinService.getCheckinItems();
  setItems(updatedItems);
};
```

## æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„æ•°æ®æ¨¡å‹å­—æ®µ

#### æ­¥éª¤1ï¼šæ›´æ–°TypeScriptæ¥å£
```typescript
// src/types/checkin.ts
export interface CheckinItem {
  id: number | string;
  title: string;
  description?: string;
  icon: string;
  color: string;
  category: CheckinCategory;
  target_type: 'daily' | 'weekly' | 'custom';
  target_count: number;
  created_at: Date;
  updated_at: Date;
  user_id: string;
  is_active: boolean;
  // æ–°å¢å­—æ®µ
  reminder_time?: string; // æé†’æ—¶é—´ HH:mm
  notification_enabled?: boolean; // æ˜¯å¦å¯ç”¨é€šçŸ¥
}
```

#### æ­¥éª¤2ï¼šæ›´æ–°æ•°æ®åº“è¡¨
```sql
-- supabase_checkin_tables.sql
ALTER TABLE checkin_items ADD COLUMN reminder_time VARCHAR(5);
ALTER TABLE checkin_items ADD COLUMN notification_enabled BOOLEAN DEFAULT false;
```

#### æ­¥éª¤3ï¼šæ›´æ–°æœåŠ¡å±‚
```typescript
// src/utils/checkinService.ts
async createCheckinItem(item: Omit<CheckinItem, 'id' | 'created_at' | 'updated_at' | 'user_id'>): Promise<CheckinItem> {
  const { data, error } = await supabase
    .from('checkin_items')
    .insert({
      ...item,
      user_id: user.id,
      reminder_time: item.reminder_time,
      notification_enabled: item.notification_enabled
    })
    .select()
    .single();
  // ...
}
```

### è‡ªå®šä¹‰éªŒè¯è§„åˆ™

#### æ·»åŠ ä¸šåŠ¡è§„åˆ™éªŒè¯
```typescript
export const validateCustomRules = (item: CheckinItem): string[] => {
  const errors: string[] = [];
  
  // éªŒè¯ç›®æ ‡æ¬¡æ•°åˆç†æ€§
  if (item.target_type === 'daily' && item.target_count > 10) {
    errors.push("æ¯æ—¥ç›®æ ‡æ¬¡æ•°ä¸åº”è¶…è¿‡10æ¬¡");
  }
  
  // éªŒè¯é¢œè‰²æ ¼å¼
  if (!/^#[0-9A-F]{6}$/i.test(item.color)) {
    errors.push("é¢œè‰²æ ¼å¼å¿…é¡»ä¸ºåå…­è¿›åˆ¶");
  }
  
  // éªŒè¯æé†’æ—¶é—´æ ¼å¼
  if (item.reminder_time && !/^([01]\d|2[0-3]):([0-5]\d)$/.test(item.reminder_time)) {
    errors.push("æé†’æ—¶é—´æ ¼å¼å¿…é¡»ä¸ºHH:mm");
  }
  
  return errors;
};
```

### æ‰¹é‡æ“ä½œä¼˜åŒ–

#### å®ç°æ‰¹é‡åˆ›å»º
```typescript
async batchCreateCheckinItems(items: Omit<CheckinItem, 'id' | 'created_at' | 'updated_at' | 'user_id'>[]): Promise<CheckinItem[]> {
  const { data, error } = await supabase
    .from('checkin_items')
    .insert(items.map(item => ({ ...item, user_id: user.id })))
    .select();
    
  if (error) throw error;
  
  return data.map(item => ({
    ...item,
    created_at: new Date(item.created_at),
    updated_at: new Date(item.updated_at)
  }));
}
```

### æ•°æ®è¿ç§»å·¥å…·

#### åˆ›å»ºæ•°æ®è¿ç§»è„šæœ¬
```typescript
// scripts/migrate-data.ts
export async function migrateCheckinItems() {
  // 1. å¯¼å‡ºç°æœ‰æ•°æ®
  const oldItems = await checkinService.getCheckinItems();
  
  // 2. è½¬æ¢æ•°æ®æ ¼å¼
  const migratedItems = oldItems.map(item => ({
    ...item,
    // æ·»åŠ é»˜è®¤å€¼
    reminder_time: item.reminder_time || '09:00',
    notification_enabled: item.notification_enabled ?? true
  }));
  
  // 3. æ‰¹é‡å¯¼å…¥æ–°æ•°æ®
  await batchCreateCheckinItems(migratedItems);
  
  console.log(`æˆåŠŸè¿ç§» ${migratedItems.length} ä¸ªé¡¹ç›®`);
}
```

### æ‰©å±•ç»Ÿè®¡åŠŸèƒ½

#### æ·»åŠ æ–°çš„ç»Ÿè®¡æŒ‡æ ‡
```typescript
export interface ExtendedCheckinStats extends CheckinStats {
  average_completion_time?: number;     // å¹³å‡å®Œæˆæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
  top_categories?: string[];           // å‰ä¸‰å¤§åˆ†ç±»
  engagement_score?: number;           // ç”¨æˆ·å‚ä¸åº¦è¯„åˆ†
  recommendation?: string;             // ä¸ªæ€§åŒ–å»ºè®®
}

// å®ç°æ–°çš„ç»Ÿè®¡è®¡ç®—
const calculateExtendedStats = (items: CheckinItem[], records: CheckinRecord[]): ExtendedCheckinStats => {
  const baseStats = calculateBasicStats(items, records);
  
  // è®¡ç®—å¹³å‡å®Œæˆæ—¶é—´
  const avgCompletionTime = calculateAverageCompletionTime(records);
  
  // è®¡ç®—ç”¨æˆ·å‚ä¸åº¦
  const engagementScore = calculateEngagementScore(baseStats);
  
  return {
    ...baseStats,
    average_completion_time: avgCompletionTime,
    engagement_score: engagementScore,
    recommendation: generateRecommendation(baseStats, engagementScore)
  };
};
```

é€šè¿‡éµå¾ªè¿™äº›æ‰©å±•æŒ‡å—ï¼Œå¼€å‘è€…å¯ä»¥å®‰å…¨åœ°æ‰©å±•æ‰“å¡ç³»ç»Ÿçš„åŠŸèƒ½ï¼ŒåŒæ—¶ä¿æŒæ•°æ®æ¨¡å‹çš„ä¸€è‡´æ€§å’Œç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚æ¯ä¸ªæ‰©å±•éƒ½åº”è¯¥ç»è¿‡å……åˆ†çš„æµ‹è¯•ï¼Œå¹¶è€ƒè™‘å‘åå…¼å®¹æ€§ã€‚