# åšå®¢åŠŸèƒ½çŠ¶æ€ç®¡ç†ä¸è§†è§‰åé¦ˆè®¾è®¡

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx)
- [BlogDetailPage.tsx](file://src/components/BlogDetailPage.tsx)
- [BlogComponents.tsx](file://src/components/BlogComponents.tsx)
- [nativeService.ts](file://src/utils/nativeService.ts)
- [checkinService.ts](file://src/utils/checkinService.ts)
- [checkin.ts](file://src/types/checkin.ts)
- [blog_view.md](file://src/guidelines/blog_view.md)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [çŠ¶æ€ç®¡ç†æ¶æ„](#çŠ¶æ€ç®¡ç†æ¶æ„)
3. [UIçŠ¶æ€ç®¡ç†æœºåˆ¶](#uiçŠ¶æ€ç®¡ç†æœºåˆ¶)
4. [è§†è§‰åé¦ˆè®¾è®¡](#è§†è§‰åé¦ˆè®¾è®¡)
5. [è§¦è§‰åé¦ˆé›†æˆ](#è§¦è§‰åé¦ˆé›†æˆ)
6. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
7. [çŠ¶æ€åŒæ­¥å¼‚å¸¸å¤„ç†](#çŠ¶æ€åŒæ­¥å¼‚å¸¸å¤„ç†)
8. [æ•…éšœæ’é™¤æŒ‡å—](#æ•…éšœæ’é™¤æŒ‡å—)
9. [æ€»ç»“](#æ€»ç»“)

## ç®€ä»‹

æœ¬æ–‡æ¡£è¯¦ç»†é˜è¿°äº†Focusåº”ç”¨ä¸­åšå®¢åŠŸèƒ½çš„çŠ¶æ€ç®¡ç†æœºåˆ¶ä¸è§†è§‰åé¦ˆè®¾è®¡ã€‚åšå®¢åŠŸèƒ½åŒ…å«ä¸¤ä¸ªæ ¸å¿ƒé¡µé¢ï¼šBlogListPageï¼ˆåšå®¢åˆ—è¡¨é¡µï¼‰å’ŒBlogDetailPageï¼ˆåšå®¢è¯¦æƒ…é¡µï¼‰ï¼Œä»¥åŠç›¸å…³çš„ç»„ä»¶å¦‚BlogCardï¼ˆåšå®¢å¡ç‰‡ï¼‰ã€‚ç³»ç»Ÿé‡‡ç”¨React Hooksè¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Œé€šè¿‡useStateå’ŒuseMemoå®ç°é«˜æ•ˆçš„UIçŠ¶æ€æ§åˆ¶ï¼Œå¹¶é›†æˆäº†åŸç”Ÿè§¦è§‰åé¦ˆå’Œè§†è§‰åŠ¨ç”»æ•ˆæœï¼Œä¸ºç”¨æˆ·æä¾›æµç•…ä¸”å¯Œæœ‰äº¤äº’æ€§çš„ä½“éªŒã€‚

## çŠ¶æ€ç®¡ç†æ¶æ„

### æ ¸å¿ƒçŠ¶æ€ç®¡ç†ç»„ä»¶

åšå®¢åŠŸèƒ½çš„çŠ¶æ€ç®¡ç†ä¸»è¦åˆ†å¸ƒåœ¨ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ä¸­ï¼Œæ¯ä¸ªç»„ä»¶è´Ÿè´£ä¸åŒçš„çŠ¶æ€ç»´åº¦ï¼š

```mermaid
graph TB
subgraph "çŠ¶æ€ç®¡ç†å±‚"
BLP[BlogListPage<br/>æœç´¢ã€ç­›é€‰ã€æ’åºçŠ¶æ€]
BDP[BlogDetailPage<br/>ç‚¹èµã€åˆ†äº«çŠ¶æ€]
BC[BlogComponents<br/>åˆ›å»ºã€ç¼–è¾‘çŠ¶æ€]
end
subgraph "çŠ¶æ€ç±»å‹"
US[useState<br/>åŸºç¡€çŠ¶æ€ç®¡ç†]
UM[useMemo<br/>è®¡ç®—çŠ¶æ€ä¼˜åŒ–]
UE[useEffect<br/>å‰¯ä½œç”¨å¤„ç†]
end
subgraph "å¤–éƒ¨ä¾èµ–"
NS[NativeService<br/>è§¦è§‰åé¦ˆ]
CS[CheckinService<br/>æ•°æ®æœåŠ¡]
FV[Figmaè®¾è®¡è§„èŒƒ<br/>è§†è§‰æ ‡å‡†]
end
BLP --> US
BDP --> US
BC --> US
BLP --> UM
BDP --> UE
BC --> UE
US --> NS
UM --> CS
UE --> FV
```

**å›¾è¡¨æ¥æº**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L1-L50)
- [BlogDetailPage.tsx](file://src/components/BlogDetailPage.tsx#L1-L50)
- [BlogComponents.tsx](file://src/components/BlogComponents.tsx#L1-L50)

### çŠ¶æ€å±‚æ¬¡ç»“æ„

```mermaid
classDiagram
class BlogListPage {
+useState searchTerm
+useState viewMode
+useState showFilters
+useState sortBy
+useState sortOrder
+useState selectedMood
+useState selectedTags
+useState dateRange
+useState page
+useMemo filteredAndSortedBlogs
+useEffect infiniteScroll
+handleSearch()
+handleToggleTag()
+handleClearFilters()
}
class BlogDetailPage {
+useState isLiking
+useState showMore
+useState relatedRecords
+incrementViewCount()
+loadRelatedRecords()
+handleLike()
+handleShare()
}
class BlogCard {
+useState isLiking
+handleLike()
+handleDelete()
}
class NativeService {
+hapticLight()
+hapticMedium()
+hapticHeavy()
+showToast()
}
BlogListPage --> BlogCard : "æ¸²æŸ“"
BlogDetailPage --> BlogCard : "å…³è”"
BlogCard --> NativeService : "è§¦è§‰åé¦ˆ"
BlogListPage --> NativeService : "è§¦è§‰åé¦ˆ"
```

**å›¾è¡¨æ¥æº**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L40-L120)
- [BlogDetailPage.tsx](file://src/components/BlogDetailPage.tsx#L25-L80)
- [BlogComponents.tsx](file://src/components/BlogComponents.tsx#L500-L550)

**ç« èŠ‚æ¥æº**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L1-L571)
- [BlogDetailPage.tsx](file://src/components/BlogDetailPage.tsx#L1-L417)
- [BlogComponents.tsx](file://src/components/BlogComponents.tsx#L1-L632)

## UIçŠ¶æ€ç®¡ç†æœºåˆ¶

### BlogListPageçŠ¶æ€ç®¡ç†

BlogListPageå®ç°äº†å¤æ‚çš„çŠ¶æ€ç®¡ç†ç³»ç»Ÿï¼Œæ¶µç›–æœç´¢ã€ç­›é€‰ã€æ’åºç­‰å¤šä¸ªç»´åº¦ï¼š

#### åŸºç¡€UIçŠ¶æ€

```typescript
// æœç´¢çŠ¶æ€ç®¡ç†
const [searchTerm, setSearchTerm] = useState("");
const handleSearch = (value: string) => {
  setSearchTerm(value);
  setPage(1); // é‡ç½®é¡µç 
};

// è§†å›¾æ¨¡å¼çŠ¶æ€
const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid');

// ç­›é€‰é¢æ¿çŠ¶æ€
const [showFilters, setShowFilters] = useState(false);
```

#### é«˜çº§ç­›é€‰çŠ¶æ€

```typescript
// æ’åºçŠ¶æ€
const [sortBy, setSortBy] = useState<'created_at' | 'like_count' | 'view_count'>('created_at');
const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('desc');

// å¿ƒæƒ…ç­›é€‰çŠ¶æ€
const [selectedMood, setSelectedMood] = useState<CheckinMood | 'all'>('all');

// æ ‡ç­¾ç­›é€‰çŠ¶æ€
const [selectedTags, setSelectedTags] = useState<string[]>([]);

// æ—¥æœŸèŒƒå›´ç­›é€‰çŠ¶æ€
const [dateRange, setDateRange] = useState<'all' | 'week' | 'month' | 'year'>('all');
```

#### è®¡ç®—çŠ¶æ€ä¼˜åŒ–

BlogListPageä½¿ç”¨React.useMemoè¿›è¡Œé«˜æ•ˆçš„çŠ¶æ€è®¡ç®—ï¼š

```typescript
const filteredAndSortedBlogs = React.useMemo(() => {
  let filtered = blogs;

  // æœç´¢ç­›é€‰
  if (searchTerm.trim()) {
    const searchLower = searchTerm.toLowerCase();
    filtered = filtered.filter(blog => 
      blog.title.toLowerCase().includes(searchLower) ||
      blog.content.toLowerCase().includes(searchLower) ||
      blog.tags.some(tag => tag.toLowerCase().includes(searchLower)) ||
      (blog.location && blog.location.toLowerCase().includes(searchLower))
    );
  }

  // å¿ƒæƒ…ç­›é€‰
  if (selectedMood !== 'all') {
    filtered = filtered.filter(blog => blog.mood === selectedMood);
  }

  // æ ‡ç­¾ç­›é€‰
  if (selectedTags.length > 0) {
    filtered = filtered.filter(blog => 
      selectedTags.some(tag => blog.tags.includes(tag))
    );
  }

  // æ—¥æœŸç­›é€‰
  if (dateRange !== 'all') {
    const now = new Date();
    const startDate = new Date();
    
    switch (dateRange) {
      case 'week':
        startDate.setDate(now.getDate() - 7);
        break;
      case 'month':
        startDate.setMonth(now.getMonth() - 1);
        break;
      case 'year':
        startDate.setFullYear(now.getFullYear() - 1);
        break;
    }
    
    filtered = filtered.filter(blog => blog.created_at >= startDate);
  }

  // æ’åº
  return filtered.sort((a, b) => {
    let aValue: number;
    let bValue: number;

    switch (sortBy) {
      case 'like_count':
        aValue = a.like_count;
        bValue = b.like_count;
        break;
      case 'view_count':
        aValue = a.view_count;
        bValue = b.view_count;
        break;
      default: // created_at
        aValue = a.created_at.getTime();
        bValue = b.created_at.getTime();
    }

    return sortOrder === 'desc' ? bValue - aValue : aValue - bValue;
  });
}, [blogs, searchTerm, selectedMood, selectedTags, dateRange, sortBy, sortOrder]);
```

### BlogDetailPageçŠ¶æ€ç®¡ç†

BlogDetailPageä¸“æ³¨äºå•ä¸ªåšå®¢çš„äº¤äº’çŠ¶æ€ï¼š

```typescript
// ç‚¹èµçŠ¶æ€ç®¡ç†
const [isLiking, setIsLiking] = useState(false);

// æ›´å¤šæ“ä½œé¢æ¿çŠ¶æ€
const [showMore, setShowMore] = useState(false);

// å…³è”è®°å½•çŠ¶æ€
const [relatedRecords, setRelatedRecords] = useState<CheckinRecord[]>([]);
```

#### ç‚¹èµçŠ¶æ€æµç¨‹

```mermaid
sequenceDiagram
participant User as ç”¨æˆ·
participant BDP as BlogDetailPage
participant NS as NativeService
participant CS as CheckinService
participant UI as UIç»„ä»¶
User->>BDP : ç‚¹å‡»ç‚¹èµæŒ‰é’®
BDP->>BDP : è®¾ç½®isLiking=true
BDP->>NS : hapticLight()
NS-->>BDP : è§¦è§‰åé¦ˆ
BDP->>CS : onLike(blogId)
CS-->>BDP : ç‚¹èµæˆåŠŸ
BDP->>UI : æ›´æ–°ç‚¹èµæ•°
BDP->>BDP : è®¾ç½®isLiking=false
UI-->>User : æ˜¾ç¤ºæ–°ç‚¹èµæ•°
```

**å›¾è¡¨æ¥æº**
- [BlogDetailPage.tsx](file://src/components/BlogDetailPage.tsx#L50-L70)

### BlogCardç»„ä»¶çŠ¶æ€ç®¡ç†

BlogCardå®ç°äº†ç‹¬ç«‹çš„çŠ¶æ€ç®¡ç†ï¼Œæ”¯æŒç‚¹èµå’Œåˆ é™¤æ“ä½œï¼š

```typescript
const [isLiking, setIsLiking] = useState(false);

const handleLike = async (e: React.MouseEvent) => {
  e.stopPropagation();
  if (isLiking) return;
  
  try {
    setIsLiking(true);
    await NativeService.hapticLight();
    onLike(blog.id);
  } catch (error) {
    console.error('Like failed:', error);
  } finally {
    setIsLiking(false);
  }
};
```

**ç« èŠ‚æ¥æº**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L40-L150)
- [BlogDetailPage.tsx](file://src/components/BlogDetailPage.tsx#L25-L80)
- [BlogComponents.tsx](file://src/components/BlogComponents.tsx#L500-L550)

## è§†è§‰åé¦ˆè®¾è®¡

### Figmaè®¾è®¡è§„èŒƒéµå¾ª

æ ¹æ®blog_view.mdè®¾è®¡è§„èŒƒï¼Œåšå®¢ç»„ä»¶ä¸¥æ ¼éµå¾ªä»¥ä¸‹è§†è§‰æ ‡å‡†ï¼š

#### ç°ä»£åšå®¢å¡ç‰‡è®¾è®¡

```css
/* å¡ç‰‡å®¹å™¨æ ·å¼ */
.bg-white.rounded-[28px].p-6.shadow-[0_12px_24px_-4px_rgba(0,0,0,0.1)]

/* æ ‡é¢˜æ ·å¼ */
.text-2xl.font-bold.text-[#333333].mb-4.leading-tight

/* å†…å®¹æ ·å¼ */
.text-base.text-[#757575].leading-relaxed.mb-6

/* å›¾åƒæ ·å¼ */
.relative.rounded-[20px].overflow-hidden.mb-4
```

#### è§†è§‰çŠ¶æ€æ˜ å°„

```mermaid
stateDiagram-v2
[*] --> æ­£å¸¸çŠ¶æ€
æ­£å¸¸çŠ¶æ€ --> æ‚¬åœçŠ¶æ€ : é¼ æ ‡æ‚¬åœ
æ­£å¸¸çŠ¶æ€ --> ç‚¹å‡»çŠ¶æ€ : ç”¨æˆ·ç‚¹å‡»
æ­£å¸¸çŠ¶æ€ --> åŠ è½½çŠ¶æ€ : æ•°æ®åŠ è½½
æ­£å¸¸çŠ¶æ€ --> é”™è¯¯çŠ¶æ€ : æ“ä½œå¤±è´¥
æ‚¬åœçŠ¶æ€ --> æ­£å¸¸çŠ¶æ€ : ç§»å¼€é¼ æ ‡
æ‚¬åœçŠ¶æ€ --> ç‚¹å‡»çŠ¶æ€ : ç‚¹å‡»ç¡®è®¤
ç‚¹å‡»çŠ¶æ€ --> æ­£å¸¸çŠ¶æ€ : æ“ä½œå®Œæˆ
ç‚¹å‡»çŠ¶æ€ --> åŠ è½½çŠ¶æ€ : å¼‚æ­¥æ“ä½œ
åŠ è½½çŠ¶æ€ --> æ­£å¸¸çŠ¶æ€ : åŠ è½½å®Œæˆ
åŠ è½½çŠ¶æ€ --> é”™è¯¯çŠ¶æ€ : åŠ è½½å¤±è´¥
é”™è¯¯çŠ¶æ€ --> æ­£å¸¸çŠ¶æ€ : é‡è¯•æˆåŠŸ
é”™è¯¯çŠ¶æ€ --> [*] : æ”¾å¼ƒæ“ä½œ
```

### åŠ¨ç”»ä¸è¿‡æ¸¡æ•ˆæœ

#### Framer MotionåŠ¨ç”»é›†æˆ

```typescript
// BlogListPageä¸­çš„ç½‘æ ¼è§†å›¾åŠ¨ç”»
<AnimatePresence>
  {filteredAndSortedBlogs.map((blog, index) => (
    <div 
      key={blog.id}
      ref={index === filteredAndSortedBlogs.length - 1 ? lastBlogElementRef : null}
    >
      <BlogCard
        blog={blog}
        onBlogClick={onBlogClick}
        onLike={onLikeBlog}
        onDelete={onDeleteBlog}
        showActions={true}
      />
    </div>
  ))}
</AnimatePresence>

// BlogDetailPageä¸­çš„ä¾§æ»‘åŠ¨ç”»
<motion.div
  initial={{ x: '100%' }}
  animate={{ x: 0 }}
  exit={{ x: '100%' }}
  transition={{ type: "spring", damping: 30, stiffness: 300 }}
  className="fixed inset-0 bg-gray-50 z-50 overflow-hidden"
>
```

#### Loader2åŠ è½½åŠ¨ç”»

```typescript
// åŠ è½½çŠ¶æ€çš„è§†è§‰åé¦ˆ
{isLoading ? (
  <div className="flex items-center gap-2 text-gray-500">
    <Loader2 className="h-4 w-4 animate-spin" />
    <span className="text-sm">åŠ è½½ä¸­...</span>
  </div>
) : null}
```

### è§†è§‰çŠ¶æ€åŒæ­¥

#### çŠ¶æ€åˆ°UIçš„æ˜ å°„å…³ç³»

```mermaid
graph LR
subgraph "çŠ¶æ€å˜é‡"
SL[searchTerm]
VM[viewMode]
SF[showFilters]
IL[isLiking]
SM[showMore]
end
subgraph "UIå…ƒç´ "
SI[æœç´¢è¾“å…¥æ¡†]
VB[è§†å›¾åˆ‡æ¢æŒ‰é’®]
FP[ç­›é€‰é¢æ¿]
LP[ç‚¹èµæŒ‰é’®]
MP[æ›´å¤šæ“ä½œé¢æ¿]
end
subgraph "è§†è§‰è¡¨ç°"
SS[æœç´¢é«˜äº®]
VS[å›¾æ ‡å˜åŒ–]
OS[é¢æ¿å±•å¼€]
LS[åŠ è½½åŠ¨ç”»]
MS[èœå•æ˜¾ç¤º]
end
SL --> SI
VM --> VB
SF --> FP
IL --> LP
SM --> MP
SI --> SS
VB --> VS
FP --> OS
LP --> LS
MP --> MS
```

**å›¾è¡¨æ¥æº**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L200-L250)
- [BlogDetailPage.tsx](file://src/components/BlogDetailPage.tsx#L100-L150)

**ç« èŠ‚æ¥æº**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L200-L300)
- [BlogDetailPage.tsx](file://src/components/BlogDetailPage.tsx#L100-L200)
- [blog_view.md](file://src/guidelines/blog_view.md#L1-L88)

## è§¦è§‰åé¦ˆé›†æˆ

### NativeServiceè§¦è§‰åé¦ˆç³»ç»Ÿ

NativeServiceæä¾›äº†å®Œæ•´çš„è§¦è§‰åé¦ˆæœºåˆ¶ï¼Œæ”¯æŒä¸åŒå¼ºåº¦çš„è§¦è§‰åé¦ˆï¼š

```typescript
export class NativeService {
  // è½»è§¦åé¦ˆ
  static async hapticLight() {
    if (Capacitor.isNativePlatform()) {
      try {
        await Haptics.impact({ style: ImpactStyle.Light });
      } catch (error) {
        console.warn('Haptic feedback not available:', error);
      }
    }
  }

  // ä¸­ç­‰è§¦è§‰åé¦ˆ
  static async hapticMedium() {
    if (Capacitor.isNativePlatform()) {
      try {
        await Haptics.impact({ style: ImpactStyle.Medium });
      } catch (error) {
        console.warn('Haptic feedback not available:', error);
      }
    }
  }

  // é‡è§¦è§‰åé¦ˆ
  static async hapticHeavy() {
    if (Capacitor.isNativePlatform()) {
      try {
        await Haptics.impact({ style: ImpactStyle.Heavy });
      } catch (error) {
        console.warn('Haptic feedback not available:', error);
      }
    }
  }
}
```

### è§¦è§‰åé¦ˆåº”ç”¨åœºæ™¯

#### ç‚¹èµæ“ä½œè§¦è§‰åé¦ˆ

```typescript
const handleLike = async () => {
  if (isLiking) return;
  
  try {
    setIsLiking(true);
    await NativeService.hapticLight(); // è½»è§¦åé¦ˆ
    onLike(blog.id);
  } catch (error) {
    console.error('Like failed:', error);
  } finally {
    setIsLiking(false);
  }
};
```

#### æ ‡ç­¾åˆ‡æ¢è§¦è§‰åé¦ˆ

```typescript
const handleToggleTag = async (tag: string) => {
  await NativeService.hapticLight(); // è½»è§¦åé¦ˆ
  setSelectedTags(prev => 
    prev.includes(tag) 
      ? prev.filter(t => t !== tag)
      : [...prev, tag]
  );
};
```

#### åˆ é™¤æ“ä½œè§¦è§‰åé¦ˆ

```typescript
const handleDelete = async (e: React.MouseEvent) => {
  e.stopPropagation();
  if (onDelete) {
    await NativeService.hapticMedium(); // ä¸­ç­‰è§¦è§‰åé¦ˆ
    onDelete(blog.id);
  }
};
```

### è§¦è§‰åé¦ˆçŠ¶æ€æ˜ å°„

```mermaid
flowchart TD
UserAction[ç”¨æˆ·æ“ä½œ] --> ActionType{æ“ä½œç±»å‹}
ActionType --> |ç‚¹èµ| LightFeedback[è½»è§¦åé¦ˆ<br/>hapticLight]
ActionType --> |æ ‡ç­¾åˆ‡æ¢| LightFeedback
ActionType --> |åˆ é™¤| MediumFeedback[ä¸­ç­‰è§¦è§‰åé¦ˆ<br/>hapticMedium]
ActionType --> |åˆ†äº«| LightFeedback
LightFeedback --> PlatformCheck{åŸç”Ÿå¹³å°æ£€æµ‹}
MediumFeedback --> PlatformCheck
PlatformCheck --> |iOS/Android| HapticAPI[Haptics APIè°ƒç”¨]
PlatformCheck --> |Web| NoFeedback[æ— è§¦è§‰åé¦ˆ]
HapticAPI --> Success[è§¦è§‰åé¦ˆæ‰§è¡Œ]
NoFeedback --> LogWarning[è®°å½•è­¦å‘Šæ—¥å¿—]
Success --> UIUpdate[UIçŠ¶æ€æ›´æ–°]
LogWarning --> UIUpdate
```

**å›¾è¡¨æ¥æº**
- [BlogDetailPage.tsx](file://src/components/BlogDetailPage.tsx#L50-L70)
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L180-L200)
- [BlogComponents.tsx](file://src/components/BlogComponents.tsx#L500-L520)

**ç« èŠ‚æ¥æº**
- [nativeService.ts](file://src/utils/nativeService.ts#L1-L180)
- [BlogDetailPage.tsx](file://src/components/BlogDetailPage.tsx#L50-L70)
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L180-L200)

## æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### useMemoè®¡ç®—ä¼˜åŒ–

BlogListPageä½¿ç”¨useMemoé¿å…ä¸å¿…è¦çš„é‡æ–°è®¡ç®—ï¼š

```typescript
const filteredAndSortedBlogs = React.useMemo(() => {
  // å¤æ‚çš„ç­›é€‰å’Œæ’åºé€»è¾‘
  // åªæœ‰å½“ä¾èµ–æ•°ç»„ä¸­çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶æ‰é‡æ–°è®¡ç®—
}, [blogs, searchTerm, selectedMood, selectedTags, dateRange, sortBy, sortOrder]);
```

### æ— é™æ»šåŠ¨ä¼˜åŒ–

```typescript
// æ— é™æ»šåŠ¨è§‚å¯Ÿå™¨
useEffect(() => {
  if (isLoading) return;

  if (observerRef.current) observerRef.current.disconnect();

  observerRef.current = new IntersectionObserver(entries => {
    if (entries[0].isIntersecting && hasMore && onLoadMore) {
      onLoadMore();
    }
  });

  if (lastBlogElementRef.current) {
    observerRef.current.observe(lastBlogElementRef.current);
  }

  return () => {
    if (observerRef.current) observerRef.current.disconnect();
  };
}, [isLoading, hasMore, onLoadMore]);
```

### æ¡ä»¶æ¸²æŸ“ä¼˜åŒ–

```typescript
// æ¡ä»¶æ¸²æŸ“å‡å°‘DOMèŠ‚ç‚¹
{filteredAndSortedBlogs.length === 0 ? (
  <div className="flex flex-col items-center justify-center py-12 text-center">
    <div className="text-6xl mb-4">ğŸ“–</div>
    <h3 className="text-lg font-medium mb-2">
      {blogs.length === 0 ? 'è¿˜æ²¡æœ‰Blog' : 'æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„Blog'}
    </h3>
    <p className="text-gray-500 mb-4">
      {blogs.length === 0 
        ? 'åˆ†äº«ä½ çš„æ‰“å¡å¿ƒå¾—å’Œç”Ÿæ´»æ„Ÿæ‚Ÿ' 
        : 'è¯•è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–ç­›é€‰å™¨'
      }
    </p>
  </div>
) : (
  <>
    {viewMode === 'grid' ? renderGridView() : renderListView()}
  </>
)}
```

### æ€§èƒ½ç›‘æ§æŒ‡æ ‡

```mermaid
graph TB
subgraph "æ€§èƒ½æŒ‡æ ‡"
RT[å“åº”æ—¶é—´]
FP[é¦–æ¬¡ç»˜åˆ¶æ—¶é—´]
TT[æ€»åŠ è½½æ—¶é—´]
CPU[CPUä½¿ç”¨ç‡]
MEM[å†…å­˜å ç”¨]
end
subgraph "ä¼˜åŒ–ç­–ç•¥"
Memo[useMemoä¼˜åŒ–]
Lazy[æ‡’åŠ è½½]
Virtual[è™šæ‹ŸåŒ–]
Debounce[é˜²æŠ–å¤„ç†]
end
subgraph "ç›‘æ§å·¥å…·"
DevTools[æµè§ˆå™¨å¼€å‘è€…å·¥å…·]
PerfToolkit[æ€§èƒ½åˆ†æå·¥å…·]
Analytics[æ€§èƒ½ç›‘æ§SDK]
end
RT --> Memo
FP --> Lazy
TT --> Virtual
CPU --> Debounce
MEM --> Memo
Memo --> DevTools
Lazy --> PerfToolkit
Virtual --> Analytics
Debounce --> DevTools
```

**ç« èŠ‚æ¥æº**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L60-L120)
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L130-L160)

## çŠ¶æ€åŒæ­¥å¼‚å¸¸å¤„ç†

### å¼‚å¸¸çŠ¶æ€æ£€æµ‹

```typescript
// ç‚¹èµçŠ¶æ€å¼‚å¸¸å¤„ç†
const handleLike = async () => {
  if (isLiking) {
    console.warn('Already liking, skipping duplicate action');
    return;
  }
  
  try {
    setIsLiking(true);
    await NativeService.hapticLight();
    onLike(blog.id);
  } catch (error) {
    console.error('Like operation failed:', error);
    // æ¢å¤åŸå§‹çŠ¶æ€
    setIsLiking(false);
    await NativeService.showToast('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•');
  }
};
```

### çŠ¶æ€ä¸€è‡´æ€§éªŒè¯

```typescript
// çŠ¶æ€éªŒè¯å‡½æ•°
const validateStateConsistency = () => {
  // éªŒè¯ç‚¹èµçŠ¶æ€ä¸å®é™…æ•°æ®çš„ä¸€è‡´æ€§
  if (isLiking && blog.like_count === originalLikeCount) {
    console.warn('State inconsistency detected: UI loading state without data change');
  }
};
```

### é”™è¯¯æ¢å¤æœºåˆ¶

```mermaid
sequenceDiagram
participant User as ç”¨æˆ·
participant Component as ç»„ä»¶
participant Service as æœåŠ¡å±‚
participant Cache as ç¼“å­˜å±‚
participant UI as UIæ›´æ–°
User->>Component : è§¦å‘æ“ä½œ
Component->>Component : è®¾ç½®åŠ è½½çŠ¶æ€
Component->>Service : è°ƒç”¨æœåŠ¡
Service-->>Component : æœåŠ¡å¼‚å¸¸
Component->>Component : æ¢å¤åŸå§‹çŠ¶æ€
Component->>Cache : è¯»å–ç¼“å­˜æ•°æ®
Cache-->>Component : è¿”å›ç¼“å­˜æ•°æ®
Component->>UI : æ›´æ–°UIçŠ¶æ€
Component->>User : æ˜¾ç¤ºé”™è¯¯æç¤º
```

**å›¾è¡¨æ¥æº**
- [BlogDetailPage.tsx](file://src/components/BlogDetailPage.tsx#L50-L70)

### çŠ¶æ€åŒæ­¥é—®é¢˜æ’æŸ¥

#### å¸¸è§åŒæ­¥é—®é¢˜

1. **å¼‚æ­¥çŠ¶æ€ç«æ€**
   ```typescript
   // é—®é¢˜ï¼šå¤šä¸ªå¼‚æ­¥æ“ä½œåŒæ—¶ä¿®æ”¹çŠ¶æ€
   const handleMultipleLikes = async () => {
     setIsLiking(true);
     await onLike(blog.id); // å¯èƒ½è¢«å…¶ä»–æ“ä½œä¸­æ–­
     setIsLiking(false);
   };
   
   // è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨å–æ¶ˆä»¤ç‰Œ
   const abortController = new AbortController();
   
   const handleLike = async () => {
     if (abortController.signal.aborted) return;
     
     try {
       setIsLiking(true);
       await onLike(blog.id);
     } finally {
       if (!abortController.signal.aborted) {
         setIsLiking(false);
       }
     }
   };
   ```

2. **çŠ¶æ€æ›´æ–°å»¶è¿Ÿ**
   ```typescript
   // é—®é¢˜ï¼šçŠ¶æ€æ›´æ–°åç«‹å³è¯»å–å¯¼è‡´ä¸ä¸€è‡´
   const handleQuickAction = () => {
     setState(newState);
     const currentValue = state; // å¯èƒ½æ˜¯æ—§å€¼
   };
   
   // è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨å›è°ƒæˆ–é˜Ÿåˆ—
   const handleQuickAction = () => {
     setState(newState);
     setTimeout(() => {
       const currentValue = state; // ç¡®ä¿æ˜¯æ–°å€¼
     }, 0);
   };
   ```

**ç« èŠ‚æ¥æº**
- [BlogDetailPage.tsx](file://src/components/BlogDetailPage.tsx#L50-L70)
- [checkinService.ts](file://src/utils/checkinService.ts#L600-L650)

## æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜è¯Šæ–­

#### è§¦è§‰åé¦ˆå¤±æ•ˆ

**ç—‡çŠ¶**ï¼šç”¨æˆ·ç‚¹å‡»åæ²¡æœ‰è§¦è§‰åé¦ˆ

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ£€æŸ¥è®¾å¤‡æ˜¯å¦æ”¯æŒè§¦è§‰åé¦ˆ
2. éªŒè¯NativeServiceåˆå§‹åŒ–çŠ¶æ€
3. æ£€æŸ¥å¹³å°å…¼å®¹æ€§

```typescript
// è§¦è§‰åé¦ˆè¯Šæ–­å‡½æ•°
const diagnoseHapticFeedback = async () => {
  console.log('Platform:', NativeService.getPlatform());
  console.log('Is Native:', NativeService.isNative());
  
  try {
    await NativeService.hapticLight();
    console.log('Haptic feedback working');
  } catch (error) {
    console.error('Haptic feedback failed:', error);
  }
};
```

#### çŠ¶æ€æ›´æ–°ä¸åŠæ—¶

**ç—‡çŠ¶**ï¼šUIçŠ¶æ€ä¸å®é™…æ•°æ®ä¸ä¸€è‡´

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ£€æŸ¥çŠ¶æ€æ›´æ–°æ—¶æœº
2. éªŒè¯å¼‚æ­¥æ“ä½œå®ŒæˆçŠ¶æ€
3. æ£€æŸ¥çŠ¶æ€ä¾èµ–å…³ç³»

```typescript
// çŠ¶æ€è¯Šæ–­å‡½æ•°
const diagnoseStateUpdates = () => {
  console.log('Current State:', {
    isLiking,
    blogLikeCount: blog.like_count,
    originalLikeCount: originalLikeCount
  });
  
  if (isLiking && blog.like_count === originalLikeCount) {
    console.warn('Potential state inconsistency detected');
  }
};
```

#### æ€§èƒ½é—®é¢˜è¯Šæ–­

**ç—‡çŠ¶**ï¼šç•Œé¢å“åº”ç¼“æ…¢æˆ–å¡é¡¿

**æ’æŸ¥æ­¥éª¤**ï¼š
1. ä½¿ç”¨React Profileråˆ†æç»„ä»¶æ¸²æŸ“
2. æ£€æŸ¥useMemoä¾èµ–é¡¹æ˜¯å¦æ­£ç¡®
3. åˆ†ææ— é™æ»šåŠ¨æ€§èƒ½ç“¶é¢ˆ

```typescript
// æ€§èƒ½è¯Šæ–­å‡½æ•°
const diagnosePerformance = () => {
  console.time('Blog filtering');
  const filtered = applyFilters(blogs, filters);
  console.timeEnd('Blog filtering');
  
  console.log('Filtered blogs:', filtered.length);
  console.log('Total blogs:', blogs.length);
};
```

### è°ƒè¯•å·¥å…·é›†æˆ

```mermaid
graph TB
subgraph "è°ƒè¯•å·¥å…·"
ReactDevTools[Reactå¼€å‘è€…å·¥å…·]
ConsoleLog[æ§åˆ¶å°æ—¥å¿—]
NetworkMonitor[ç½‘ç»œç›‘æ§]
PerformanceProfiler[æ€§èƒ½åˆ†æå™¨]
end
subgraph "è¯Šæ–­æŒ‡æ ‡"
StateConsistency[çŠ¶æ€ä¸€è‡´æ€§]
RenderFrequency[æ¸²æŸ“é¢‘ç‡]
APILatency[APIå»¶è¿Ÿ]
MemoryUsage[å†…å­˜ä½¿ç”¨]
end
subgraph "è§£å†³æ–¹æ¡ˆ"
StateFix[çŠ¶æ€ä¿®å¤]
OptimizeRender[æ¸²æŸ“ä¼˜åŒ–]
RetryLogic[é‡è¯•é€»è¾‘]
CacheStrategy[ç¼“å­˜ç­–ç•¥]
end
ReactDevTools --> StateConsistency
ConsoleLog --> RenderFrequency
NetworkMonitor --> APILatency
PerformanceProfiler --> MemoryUsage
StateConsistency --> StateFix
RenderFrequency --> OptimizeRender
APILatency --> RetryLogic
MemoryUsage --> CacheStrategy
```

### æœ€ä½³å®è·µå»ºè®®

1. **çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ**
   - ä½¿ç”¨å•ä¸€æ•°æ®æºåŸåˆ™
   - é¿å…æ·±å±‚åµŒå¥—çŠ¶æ€
   - åˆç†ä½¿ç”¨çŠ¶æ€æå‡

2. **æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ**
   - æ­£ç¡®ä½¿ç”¨useMemoå’ŒuseCallback
   - å®ç°é€‚å½“çš„é˜²æŠ–å’ŒèŠ‚æµ
   - ä¼˜åŒ–å¤§å‹åˆ—è¡¨æ¸²æŸ“

3. **ç”¨æˆ·ä½“éªŒæœ€ä½³å®è·µ**
   - æä¾›æ¸…æ™°çš„åŠ è½½çŠ¶æ€
   - å®ç°ä¼˜é›…çš„é”™è¯¯å¤„ç†
   - ç¡®ä¿è§¦è§‰åé¦ˆä¸€è‡´æ€§

**ç« èŠ‚æ¥æº**
- [nativeService.ts](file://src/utils/nativeService.ts#L10-L50)
- [BlogDetailPage.tsx](file://src/components/BlogDetailPage.tsx#L50-L70)

## æ€»ç»“

Focusåº”ç”¨çš„åšå®¢åŠŸèƒ½å±•ç°äº†ç°ä»£Reactåº”ç”¨ä¸­çŠ¶æ€ç®¡ç†ä¸è§†è§‰åé¦ˆè®¾è®¡çš„æœ€ä½³å®è·µã€‚é€šè¿‡ç²¾å¿ƒè®¾è®¡çš„çŠ¶æ€ç®¡ç†æ¶æ„ã€ç²¾ç¡®çš„è§†è§‰åé¦ˆç³»ç»Ÿå’Œå®Œå–„çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼Œç³»ç»Ÿä¸ºç”¨æˆ·æä¾›äº†æµç•…ä¸”å¯Œæœ‰äº¤äº’æ€§çš„åšå®¢ä½“éªŒã€‚

### å…³é”®æŠ€æœ¯äº®ç‚¹

1. **åˆ†å±‚çŠ¶æ€ç®¡ç†**ï¼šBlogListPageã€BlogDetailPageå’ŒBlogComponentså„è‡ªè´Ÿè´£ä¸åŒçš„çŠ¶æ€ç»´åº¦ï¼Œå®ç°äº†æ¸…æ™°çš„èŒè´£åˆ†ç¦»
2. **é«˜æ€§èƒ½è®¡ç®—ä¼˜åŒ–**ï¼šé€šè¿‡useMemoå’ŒuseEffectçš„åˆç†è¿ç”¨ï¼Œç¡®ä¿äº†å¤æ‚ç­›é€‰å’Œæ’åºæ“ä½œçš„é«˜æ•ˆæ‰§è¡Œ
3. **åŸç”Ÿè§¦è§‰åé¦ˆé›†æˆ**ï¼šNativeServiceæä¾›äº†å®Œæ•´çš„è§¦è§‰åé¦ˆæœºåˆ¶ï¼Œå¢å¼ºäº†ç§»åŠ¨ç«¯çš„äº¤äº’ä½“éªŒ
4. **è§†è§‰ä¸€è‡´æ€§ä¿éšœ**ï¼šä¸¥æ ¼éµå¾ªFigmaè®¾è®¡è§„èŒƒï¼Œç¡®ä¿äº†UIçŠ¶æ€çš„å‡†ç¡®è¡¨è¾¾å’Œè§†è§‰æ•ˆæœçš„ä¸€è‡´æ€§

### è®¾è®¡åŸåˆ™æ€»ç»“

- **çŠ¶æ€é©±åŠ¨**ï¼šæ‰€æœ‰UIå˜åŒ–éƒ½ç”±çŠ¶æ€é©±åŠ¨ï¼Œç¡®ä¿äº†çŠ¶æ€ä¸UIçš„ä¸€è‡´æ€§
- **æ¸è¿›å¢å¼º**ï¼šåœ¨åŸç”Ÿå¹³å°ä¸Šæä¾›ä¸°å¯Œçš„è§¦è§‰å’Œè§†è§‰åé¦ˆï¼Œåœ¨Webå¹³å°ä¸Šæä¾›ä¼˜é›…çš„é™çº§æ–¹æ¡ˆ
- **æ€§èƒ½ä¼˜å…ˆ**ï¼šé€šè¿‡åˆç†çš„ä¼˜åŒ–ç­–ç•¥ï¼Œç¡®ä¿äº†å¤§è§„æ¨¡æ•°æ®é›†çš„æµç•…æ¸²æŸ“
- **ç”¨æˆ·ä½“éªŒå¯¼å‘**ï¼šæ³¨é‡ç”¨æˆ·äº¤äº’çš„å³æ—¶åé¦ˆå’Œé”™è¯¯å¤„ç†çš„å‹å¥½æ€§

è¿™å¥—çŠ¶æ€ç®¡ç†ä¸è§†è§‰åé¦ˆè®¾è®¡ä½“ç³»ä¸ä»…æ»¡è¶³äº†å½“å‰çš„åŠŸèƒ½éœ€æ±‚ï¼Œä¹Ÿä¸ºæœªæ¥çš„åŠŸèƒ½æ‰©å±•å’Œæ€§èƒ½ä¼˜åŒ–å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚é€šè¿‡æŒç»­çš„ç›‘æ§å’Œä¼˜åŒ–ï¼Œç³»ç»Ÿèƒ½å¤Ÿä¸ºç”¨æˆ·æä¾›ç¨³å®šã€æµç•…ä¸”å¯Œæœ‰æƒ…æ„Ÿçš„åšå®¢ä½“éªŒã€‚