# åˆ—è¡¨ä¸ç½‘æ ¼è§†å›¾æ¸²æŸ“æœºåˆ¶æ·±åº¦åˆ†æ

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx)
- [checkin.ts](file://src/types/checkin.ts)
- [BlogComponents.tsx](file://src/components/BlogComponents.tsx)
- [blog_view.md](file://src/guidelines/blog_view.md)
- [globals.css](file://src/styles/globals.css)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é¡¹ç›®ç»“æ„æ¦‚è§ˆ](#é¡¹ç›®ç»“æ„æ¦‚è§ˆ)
3. [æ ¸å¿ƒç»„ä»¶æ¶æ„](#æ ¸å¿ƒç»„ä»¶æ¶æ„)
4. [è§†å›¾æ¨¡å¼çŠ¶æ€ç®¡ç†](#è§†å›¾æ¨¡å¼çŠ¶æ€ç®¡ç†)
5. [æ— é™æ»šåŠ¨åŠ è½½ç­–ç•¥](#æ— é™æ»šåŠ¨åŠ è½½ç­–ç•¥)
6. [åŠ¨æ€è¿‡æ»¤ä¸æ’åºç®—æ³•](#åŠ¨æ€è¿‡æ»¤ä¸æ’åºç®—æ³•)
7. [UIçŠ¶æ€å¤„ç†æµç¨‹](#uiçŠ¶æ€å¤„ç†æµç¨‹)
8. [å“åº”å¼å¸ƒå±€é€‚é…](#å“åº”å¼å¸ƒå±€é€‚é…)
9. [æ€§èƒ½ä¼˜åŒ–åˆ†æ](#æ€§èƒ½ä¼˜åŒ–åˆ†æ)
10. [æ•…éšœæ’é™¤æŒ‡å—](#æ•…éšœæ’é™¤æŒ‡å—)
11. [æ€»ç»“](#æ€»ç»“)

## ç®€ä»‹

BlogListPage.tsxæ˜¯æœ¬é¡¹ç›®ä¸­è´Ÿè´£åšå®¢åˆ—è¡¨å±•ç¤ºçš„æ ¸å¿ƒç»„ä»¶ï¼Œå®ç°äº†ç°ä»£åŒ–çš„åˆ—è¡¨ä¸ç½‘æ ¼è§†å›¾åˆ‡æ¢æœºåˆ¶ã€‚è¯¥ç»„ä»¶ä¸ä»…æä¾›äº†ä¸°å¯Œçš„ç”¨æˆ·äº¤äº’åŠŸèƒ½ï¼Œè¿˜é‡‡ç”¨äº†å…ˆè¿›çš„æ— é™æ»šåŠ¨åŠ è½½ç­–ç•¥å’Œæ™ºèƒ½çš„åŠ¨æ€è¿‡æ»¤æ’åºç®—æ³•ï¼Œä¸ºç”¨æˆ·æä¾›æµç•…ä¸”é«˜æ•ˆçš„åšå®¢æµè§ˆä½“éªŒã€‚

æœ¬æ–‡æ¡£å°†æ·±å…¥åˆ†æè¯¥ç»„ä»¶çš„æŠ€æœ¯å®ç°ç»†èŠ‚ï¼ŒåŒ…æ‹¬è§†å›¾æ¨¡å¼çŠ¶æ€ç®¡ç†ã€æ— é™æ»šåŠ¨æœºåˆ¶ã€è¿‡æ»¤æ’åºç®—æ³•ä»¥åŠUIçŠ¶æ€å¤„ç†ç­‰æ–¹é¢çš„æŠ€æœ¯æ¶æ„å’Œå®ç°åŸç†ã€‚

## é¡¹ç›®ç»“æ„æ¦‚è§ˆ

```mermaid
graph TB
subgraph "åšå®¢ç»„ä»¶å±‚æ¬¡ç»“æ„"
BlogListPage["BlogListPage<br/>ä¸»ç»„ä»¶"]
BlogCard["BlogCard<br/>åšå®¢å¡ç‰‡ç»„ä»¶"]
FiltersPanel["ç­›é€‰é¢æ¿"]
ViewControls["è§†å›¾æ§åˆ¶"]
end
subgraph "æ•°æ®å±‚"
CheckinBlog["CheckinBlogæ¥å£"]
BlogFilters["BlogFiltersæ¥å£"]
CheckinService["CheckinService"]
end
subgraph "UIç»„ä»¶åº“"
Button["Buttonç»„ä»¶"]
Input["Inputç»„ä»¶"]
Select["Selectç»„ä»¶"]
Badge["Badgeç»„ä»¶"]
end
BlogListPage --> BlogCard
BlogListPage --> FiltersPanel
BlogListPage --> ViewControls
BlogListPage --> CheckinBlog
BlogListPage --> BlogFilters
BlogListPage --> CheckinService
BlogCard --> Button
BlogCard --> Input
BlogCard --> Select
BlogCard --> Badge
```

**å›¾è¡¨æ¥æº**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L1-L50)
- [checkin.ts](file://src/types/checkin.ts#L30-L50)

**ç« èŠ‚æ¥æº**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L1-L100)
- [checkin.ts](file://src/types/checkin.ts#L1-L50)

## æ ¸å¿ƒç»„ä»¶æ¶æ„

BlogListPageç»„ä»¶é‡‡ç”¨å‡½æ•°å¼ç»„ä»¶è®¾è®¡ï¼Œåˆ©ç”¨React Hookså®ç°çŠ¶æ€ç®¡ç†å’Œå‰¯ä½œç”¨å¤„ç†ã€‚ç»„ä»¶çš„æ ¸å¿ƒæ¶æ„åŒ…å«ä»¥ä¸‹å…³é”®éƒ¨åˆ†ï¼š

### çŠ¶æ€ç®¡ç†ç³»ç»Ÿ

```typescript
const [searchTerm, setSearchTerm] = useState("");
const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid');
const [showFilters, setShowFilters] = useState(false);
const [sortBy, setSortBy] = useState<'created_at' | 'like_count' | 'view_count'>('created_at');
const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('desc');
const [selectedMood, setSelectedMood] = useState<CheckinMood | 'all'>('all');
const [selectedTags, setSelectedTags] = useState<string[]>([]);
const [dateRange, setDateRange] = useState<'all' | 'week' | 'month' | 'year'>('all');
```

### æ•°æ®å¤„ç†ç®¡é“

ç»„ä»¶é€šè¿‡React.useMemoå®ç°é«˜æ•ˆçš„è®¡ç®—ç¼“å­˜ï¼Œç¡®ä¿åªæœ‰åœ¨ä¾èµ–é¡¹å˜åŒ–æ—¶æ‰é‡æ–°è®¡ç®—è¿‡æ»¤å’Œæ’åºç»“æœï¼š

```typescript
const filteredAndSortedBlogs = React.useMemo(() => {
  let filtered = blogs;
  
  // å¤šç»´åº¦ç­›é€‰é€»è¾‘
  if (searchTerm.trim()) {
    // æœç´¢ç­›é€‰
  }
  
  if (selectedMood !== 'all') {
    // å¿ƒæƒ…ç­›é€‰
  }
  
  if (selectedTags.length > 0) {
    // æ ‡ç­¾ç­›é€‰
  }
  
  if (dateRange !== 'all') {
    // æ—¥æœŸç­›é€‰
  }
  
  // æ’åºå¤„ç†
  return filtered.sort((a, b) => {
    // æ’åºé€»è¾‘
  });
}, [blogs, searchTerm, selectedMood, selectedTags, dateRange, sortBy, sortOrder]);
```

**ç« èŠ‚æ¥æº**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L54-L128)

## è§†å›¾æ¨¡å¼çŠ¶æ€ç®¡ç†

### è§†å›¾æ¨¡å¼åˆ‡æ¢æœºåˆ¶

BlogListPageå®ç°äº†çµæ´»çš„è§†å›¾æ¨¡å¼åˆ‡æ¢åŠŸèƒ½ï¼Œæ”¯æŒç½‘æ ¼è§†å›¾(grid)å’Œåˆ—è¡¨è§†å›¾(list)ä¸¤ç§æ¨¡å¼ã€‚è§†å›¾æ¨¡å¼çš„çŠ¶æ€ç®¡ç†é‡‡ç”¨ReactçŠ¶æ€é’©å­å®ç°ï¼š

```typescript
const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid');

// è§†å›¾åˆ‡æ¢é€»è¾‘
<Button
  variant="outline"
  size="sm"
  onClick={() => setViewMode(viewMode === 'grid' ? 'list' : 'grid')}
>
  {viewMode === 'grid' ? <List className="h-4 w-4" /> : <Grid className="h-4 w-4" />}
</Button>
```

### ç½‘æ ¼è§†å›¾å®ç°

ç½‘æ ¼è§†å›¾é‡‡ç”¨CSS Gridå¸ƒå±€ï¼Œæ¯è¡Œæ˜¾ç¤ºä¸¤ä¸ªåšå®¢å¡ç‰‡ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

```typescript
const renderGridView = () => (
  <div className="grid grid-cols-2 gap-3 p-4">
    <AnimatePresence>
      {filteredAndSortedBlogs.map((blog, index) => (
        <div 
          key={blog.id}
          ref={index === filteredAndSortedBlogs.length - 1 ? lastBlogElementRef : null}
        >
          <BlogCard
            blog={blog}
            onBlogClick={onBlogClick}
            onLike={onLikeBlog}
            onDelete={onDeleteBlog}
            showActions={true}
          />
        </div>
      ))}
    </AnimatePresence>
  </div>
);
```

### åˆ—è¡¨è§†å›¾å®ç°

åˆ—è¡¨è§†å›¾é‡‡ç”¨Flexboxå¸ƒå±€ï¼Œæä¾›æ›´è¯¦ç»†çš„å†…å®¹å±•ç¤ºï¼š

```typescript
const renderListView = () => (
  <div className="p-4 space-y-3">
    {filteredAndSortedBlogs.map((blog, index) => (
      <motion.div
        key={blog.id}
        ref={index === filteredAndSortedBlogs.length - 1 ? lastBlogElementRef : null}
        layout
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        exit={{ opacity: 0, y: -20 }}
        className="bg-white rounded-xl p-4 border border-gray-100 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer"
        onClick={() => onBlogClick(blog)}
      >
        {/* åˆ—è¡¨è§†å›¾å†…å®¹ç»“æ„ */}
      </motion.div>
    ))}
  </div>
);
```

### åŠ¨ç”»æ•ˆæœé›†æˆ

ç»„ä»¶é›†æˆäº†Framer MotionåŠ¨ç”»åº“ï¼Œä¸ºè§†å›¾åˆ‡æ¢æä¾›å¹³æ»‘çš„è¿‡æ¸¡æ•ˆæœï¼š

```mermaid
sequenceDiagram
participant User as ç”¨æˆ·
participant Button as è§†å›¾åˆ‡æ¢æŒ‰é’®
participant State as çŠ¶æ€ç®¡ç†å™¨
participant Renderer as æ¸²æŸ“å™¨
participant Animation as åŠ¨ç”»ç³»ç»Ÿ
User->>Button : ç‚¹å‡»åˆ‡æ¢è§†å›¾
Button->>State : æ›´æ–°viewModeçŠ¶æ€
State->>Renderer : è§¦å‘é‡æ–°æ¸²æŸ“
Renderer->>Animation : åº”ç”¨è¿‡æ¸¡åŠ¨ç”»
Animation->>User : æ˜¾ç¤ºå¹³æ»‘åˆ‡æ¢æ•ˆæœ
Note over User,Animation : æ”¯æŒç½‘æ ¼åˆ°åˆ—è¡¨å’Œåˆ—è¡¨åˆ°ç½‘æ ¼çš„åŒå‘åŠ¨ç”»
```

**å›¾è¡¨æ¥æº**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L254-L321)

**ç« èŠ‚æ¥æº**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L254-L321)

## æ— é™æ»šåŠ¨åŠ è½½ç­–ç•¥

### Intersection Observerå®ç°

BlogListPageé‡‡ç”¨ç°ä»£çš„Intersection Observer APIå®ç°æ— é™æ»šåŠ¨åŠŸèƒ½ï¼Œé¿å…äº†ä¼ ç»Ÿçš„æ»šåŠ¨äº‹ä»¶ç›‘å¬å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ï¼š

```typescript
// æ— é™æ»šåŠ¨è§‚å¯Ÿå™¨
useEffect(() => {
  if (isLoading) return;

  if (observerRef.current) observerRef.current.disconnect();

  observerRef.current = new IntersectionObserver(entries => {
    if (entries[0].isIntersecting && hasMore && onLoadMore) {
      onLoadMore();
    }
  });

  if (lastBlogElementRef.current) {
    observerRef.current.observe(lastBlogElementRef.current);
  }

  return () => {
    if (observerRef.current) observerRef.current.disconnect();
  };
}, [isLoading, hasMore, onLoadMore]);
```

### èŠ‚æµå¤„ç†æœºåˆ¶

ä¸ºäº†é˜²æ­¢é¢‘ç¹è§¦å‘åŠ è½½ï¼Œç»„ä»¶å®ç°äº†æ™ºèƒ½çš„èŠ‚æµå¤„ç†ï¼š

```typescript
// èŠ‚æµå¤„ç†é€»è¾‘
const observerRef = useRef<IntersectionObserver>();
const lastBlogElementRef = useRef<HTMLDivElement>(null);

// åœ¨useEffectä¸­è®¾ç½®è§‚å¯Ÿå™¨
observerRef.current = new IntersectionObserver(entries => {
  if (entries[0].isIntersecting && hasMore && onLoadMore) {
    onLoadMore(); // è§¦å‘åŠ è½½æ›´å¤š
  }
});
```

### åˆ†é¡µå‚æ•°ç®¡ç†

ç»„ä»¶ç»´æŠ¤å†…éƒ¨é¡µç çŠ¶æ€ï¼Œé…åˆå¤–éƒ¨çš„hasMoreå’ŒonLoadMoreå›è°ƒå®ç°å®Œæ•´çš„åˆ†é¡µæœºåˆ¶ï¼š

```typescript
const [page, setPage] = useState(1);

// æœç´¢é‡ç½®é¡µç 
const handleSearch = (value: string) => {
  setSearchTerm(value);
  setPage(1); // é‡ç½®é¡µç 
};
```

### æ•°æ®è¿½åŠ é€»è¾‘

å½“è§‚å¯Ÿåˆ°æœ€åä¸€ä¸ªå…ƒç´ è¿›å…¥è§†å£æ—¶ï¼Œè‡ªåŠ¨è§¦å‘æ•°æ®åŠ è½½ï¼š

```mermaid
flowchart TD
Start([é¡µé¢åˆå§‹åŒ–]) --> InitObserver["åˆå§‹åŒ–Intersection Observer"]
InitObserver --> WaitScroll["ç­‰å¾…æ»šåŠ¨è§¦åº•"]
WaitScroll --> CheckVisible{"æœ€åä¸€ä¸ªå…ƒç´ å¯è§?"}
CheckVisible --> |æ˜¯| CheckLoading{"æ˜¯å¦æ­£åœ¨åŠ è½½?"}
CheckLoading --> |å¦| CheckHasMore{"è¿˜æœ‰æ›´å¤šæ•°æ®?"}
CheckLoading --> |æ˜¯| WaitScroll
CheckHasMore --> |æ˜¯| TriggerLoad["è§¦å‘onLoadMore"]
CheckHasMore --> |å¦| WaitScroll
TriggerLoad --> LoadingState["è®¾ç½®åŠ è½½çŠ¶æ€"]
LoadingState --> LoadData["åŠ è½½æ–°æ•°æ®"]
LoadData --> UpdateUI["æ›´æ–°UIæ˜¾ç¤º"]
UpdateUI --> WaitScroll
```

**å›¾è¡¨æ¥æº**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L130-L150)

**ç« èŠ‚æ¥æº**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L130-L150)

## åŠ¨æ€è¿‡æ»¤ä¸æ’åºç®—æ³•

### å¤šç»´åº¦ç­›é€‰æ¶æ„

BlogListPageå®ç°äº†å¼ºå¤§çš„å¤šç»´åº¦ç­›é€‰åŠŸèƒ½ï¼Œæ”¯æŒæœç´¢ã€å¿ƒæƒ…ã€æ ‡ç­¾ã€æ—¥æœŸèŒƒå›´ç­‰å¤šç§ç­›é€‰æ¡ä»¶ï¼š

```typescript
// ç­›é€‰å’Œæ’åºBlog
const filteredAndSortedBlogs = React.useMemo(() => {
  let filtered = blogs;

  // æœç´¢ç­›é€‰
  if (searchTerm.trim()) {
    const searchLower = searchTerm.toLowerCase();
    filtered = filtered.filter(blog => 
      blog.title.toLowerCase().includes(searchLower) ||
      blog.content.toLowerCase().includes(searchLower) ||
      blog.tags.some(tag => tag.toLowerCase().includes(searchLower)) ||
      (blog.location && blog.location.toLowerCase().includes(searchLower))
    );
  }

  // å¿ƒæƒ…ç­›é€‰
  if (selectedMood !== 'all') {
    filtered = filtered.filter(blog => blog.mood === selectedMood);
  }

  // æ ‡ç­¾ç­›é€‰
  if (selectedTags.length > 0) {
    filtered = filtered.filter(blog => 
      selectedTags.some(tag => blog.tags.includes(tag))
    );
  }

  // æ—¥æœŸç­›é€‰
  if (dateRange !== 'all') {
    const now = new Date();
    const startDate = new Date();
    
    switch (dateRange) {
      case 'week':
        startDate.setDate(now.getDate() - 7);
        break;
      case 'month':
        startDate.setMonth(now.getMonth() - 1);
        break;
      case 'year':
        startDate.setFullYear(now.getFullYear() - 1);
        break;
    }
    
    filtered = filtered.filter(blog => blog.created_at >= startDate);
  }

  // æ’åºå¤„ç†
  return filtered.sort((a, b) => {
    // æ’åºé€»è¾‘
  });
}, [blogs, searchTerm, selectedMood, selectedTags, dateRange, sortBy, sortOrder]);
```

### æ’åºç®—æ³•å®ç°

ç»„ä»¶æ”¯æŒä¸‰ç§ä¸»è¦çš„æ’åºæ–¹å¼ï¼Œæ¯ç§éƒ½æœ‰å‡åºå’Œé™åºé€‰é¡¹ï¼š

```typescript
// æ’åºå¤„ç†é€»è¾‘
return filtered.sort((a, b) => {
  let aValue: number;
  let bValue: number;

  switch (sortBy) {
    case 'like_count':
      aValue = a.like_count;
      bValue = b.like_count;
      break;
    case 'view_count':
      aValue = a.view_count;
      bValue = b.view_count;
      break;
    default: // created_at
      aValue = a.created_at.getTime();
      bValue = b.created_at.getTime();
  }

  return sortOrder === 'desc' ? bValue - aValue : aValue - bValue;
});
```

### ç­›é€‰çŠ¶æ€ç»Ÿè®¡

ç»„ä»¶æä¾›äº†å®æ—¶çš„ç­›é€‰çŠ¶æ€ç»Ÿè®¡åŠŸèƒ½ï¼š

```typescript
const getActiveFiltersCount = () => {
  let count = 0;
  if (searchTerm.trim()) count++;
  if (selectedMood !== 'all') count++;
  if (selectedTags.length > 0) count++;
  if (dateRange !== 'all') count++;
  return count;
};
```

### ç­›é€‰é¢æ¿äº¤äº’

```mermaid
classDiagram
class FilterPanel {
+boolean showFilters
+string searchTerm
+CheckinMood selectedMood
+string[] selectedTags
+string dateRange
+string sortBy
+string sortOrder
+toggleFilters()
+clearFilters()
+handleSearch(term)
+handleMoodChange(mood)
+handleTagToggle(tag)
+handleDateRangeChange(range)
}
class MoodFilter {
+CheckinMood mood
+string emoji
+string name
+selectMood()
}
class TagFilter {
+string tag
+boolean isActive
+toggleTag()
}
class DateRangeFilter {
+string range
+Date startDate
+Date endDate
+setDateRange()
}
FilterPanel --> MoodFilter : "åŒ…å«"
FilterPanel --> TagFilter : "åŒ…å«"
FilterPanel --> DateRangeFilter : "åŒ…å«"
```

**å›¾è¡¨æ¥æº**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L85-L128)

**ç« èŠ‚æ¥æº**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L85-L128)

## UIçŠ¶æ€å¤„ç†æµç¨‹

### åŠ è½½çŠ¶æ€ç®¡ç†

ç»„ä»¶å®ç°äº†å®Œå–„çš„åŠ è½½çŠ¶æ€å¤„ç†æœºåˆ¶ï¼Œç¡®ä¿ç”¨æˆ·ä½“éªŒçš„ä¸€è‡´æ€§ï¼š

```typescript
// åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨
{hasMore && (
  <div className="flex justify-center py-4">
    {isLoading ? (
      <div className="flex items-center gap-2 text-gray-500">
        <Loader2 className="h-4 w-4 animate-spin" />
        <span className="text-sm">åŠ è½½ä¸­...</span>
      </div>
    ) : null}
  </div>
)}
```

### ç©ºçŠ¶æ€å¤„ç†

å½“æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„åšå®¢æ—¶ï¼Œç»„ä»¶æä¾›å‹å¥½çš„ç©ºçŠ¶æ€æç¤ºï¼š

```typescript
{filteredAndSortedBlogs.length === 0 ? (
  <div className="flex flex-col items-center justify-center py-12 text-center">
    <div className="text-6xl mb-4">ğŸ“–</div>
    <h3 className="text-lg font-medium mb-2">
      {blogs.length === 0 ? 'è¿˜æ²¡æœ‰Blog' : 'æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„Blog'}
    </h3>
    <p className="text-gray-500 mb-4">
      {blogs.length === 0 
        ? 'åˆ†äº«ä½ çš„æ‰“å¡å¿ƒå¾—å’Œç”Ÿæ´»æ„Ÿæ‚Ÿ' 
        : 'è¯•è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–ç­›é€‰å™¨'
      }
    </p>
    {blogs.length === 0 ? (
      <Button onClick={onCreateBlog}>
        <Plus className="h-4 w-4 mr-1" />
        å†™ç¬¬ä¸€ç¯‡Blog
      </Button>
    ) : (
      <Button variant="outline" onClick={handleClearFilters}>
        <X className="h-4 w-4 mr-1" />
        æ¸…é™¤ç­›é€‰
      </Button>
    )}
  </div>
) : (
  <>
    {viewMode === 'grid' ? renderGridView() : renderListView()}
  </>
)}
```

### é”™è¯¯çŠ¶æ€å¤„ç†

è™½ç„¶å½“å‰ç‰ˆæœ¬æ²¡æœ‰æ˜¾å¼çš„é”™è¯¯çŠ¶æ€å¤„ç†ï¼Œä½†ç»„ä»¶é¢„ç•™äº†æ‰©å±•ç©ºé—´ï¼š

```typescript
// é”™è¯¯çŠ¶æ€å¤„ç†ï¼ˆå¯æ‰©å±•ï¼‰
const [error, setError] = useState<string | null>(null);

// é”™è¯¯çŠ¶æ€æ¸²æŸ“
{error && (
  <div className="flex flex-col items-center justify-center py-12 text-center">
    <div className="text-6xl mb-4">âš ï¸</div>
    <h3 className="text-lg font-medium mb-2">åŠ è½½å¤±è´¥</h3>
    <p className="text-gray-500 mb-4">{error}</p>
    <Button onClick={() => setError(null)}>é‡è¯•</Button>
  </div>
)}
```

### çŠ¶æ€è½¬æ¢æµç¨‹

```mermaid
stateDiagram-v2
[*] --> EmptyState : åšå®¢åˆ—è¡¨ä¸ºç©º
[*] --> LoadingState : å¼€å§‹åŠ è½½
[*] --> FilteredResults : åº”ç”¨ç­›é€‰æ¡ä»¶
[*] --> NoResults : ç­›é€‰åæ— ç»“æœ
EmptyState --> LoadingState : ç”¨æˆ·æ“ä½œ
LoadingState --> FilteredResults : åŠ è½½æˆåŠŸ
LoadingState --> ErrorState : åŠ è½½å¤±è´¥
FilteredResults --> NoResults : ç­›é€‰æ¡ä»¶ä¸åŒ¹é…
FilteredResults --> LoadingState : åŠ è½½æ›´å¤š
NoResults --> FilteredResults : è°ƒæ•´ç­›é€‰æ¡ä»¶
ErrorState --> LoadingState : é‡è¯•
```

**å›¾è¡¨æ¥æº**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L540-L570)

**ç« èŠ‚æ¥æº**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L540-L570)

## å“åº”å¼å¸ƒå±€é€‚é…

### ç§»åŠ¨ç«¯é€‚é…ç­–ç•¥

BlogListPageé’ˆå¯¹ä¸åŒå±å¹•å°ºå¯¸å®ç°äº†è‡ªé€‚åº”å¸ƒå±€ï¼š

```css
/* å“åº”å¼ç½‘æ ¼å¸ƒå±€ */
.grid.grid-cols-2 {
  /* é»˜è®¤ç½‘æ ¼å¸ƒå±€ */
}

@media (max-width: 768px) {
  .grid.grid-cols-2 {
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  }
}

/* åˆ—è¡¨è§†å›¾çš„ç§»åŠ¨ç«¯ä¼˜åŒ– */
.p-4.space-y-3 {
  padding: 1rem;
  gap: 0.75rem;
}
```

### å¹³æ¿è®¾å¤‡é€‚é…

å¯¹äºå¹³æ¿è®¾å¤‡ï¼Œç»„ä»¶æä¾›äº†æ›´å¤§çš„ç‚¹å‡»åŒºåŸŸå’Œæ›´å®½æ¾çš„é—´è·ï¼š

```css
/* å¹³æ¿è®¾å¤‡ç‰¹å®šæ ·å¼ */
@media (min-width: 769px) and (max-width: 1024px) {
  .grid.grid-cols-2 {
    grid-gap: 1rem;
  }
  
  .p-4.space-y-3 {
    padding: 1.5rem;
  }
}
```

### è§¦æ‘¸å‹å¥½è®¾è®¡

ç»„ä»¶ç‰¹åˆ«è€ƒè™‘äº†è§¦æ‘¸è®¾å¤‡çš„äº¤äº’éœ€æ±‚ï¼š

```typescript
// è§¦æ‘¸åé¦ˆ
const handleToggleTag = async (tag: string) => {
  await NativeService.hapticLight(); // è§¦è§‰åé¦ˆ
  setSelectedTags(prev => 
    prev.includes(tag) 
      ? prev.filter(t => t !== tag)
      : [...prev, tag]
  );
};

// è§¦æ‘¸ä¼˜åŒ–çš„æŒ‰é’®æ ·å¼
<Button
  variant="outline"
  size="sm"
  onClick={() => setViewMode(viewMode === 'grid' ? 'list' : 'grid')}
  className="touch-manipulation"
>
  {viewMode === 'grid' ? <List className="h-4 w-4" /> : <Grid className="h-4 w-4" />}
</Button>
```

**ç« èŠ‚æ¥æº**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L290-L321)

## æ€§èƒ½ä¼˜åŒ–åˆ†æ

### è®¡ç®—ç¼“å­˜ä¼˜åŒ–

ç»„ä»¶ä½¿ç”¨React.useMemoè¿›è¡Œæ˜‚è´µçš„è®¡ç®—ç¼“å­˜ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ–°è®¡ç®—ï¼š

```typescript
const filteredAndSortedBlogs = React.useMemo(() => {
  // å¤æ‚çš„ç­›é€‰å’Œæ’åºé€»è¾‘
}, [blogs, searchTerm, selectedMood, selectedTags, dateRange, sortBy, sortOrder]);
```

### æ¸²æŸ“ä¼˜åŒ–

```typescript
// ä½¿ç”¨AnimatePresenceå®ç°é«˜æ•ˆçš„åŠ¨ç”»è¿‡æ¸¡
<AnimatePresence>
  {filteredAndSortedBlogs.map((blog, index) => (
    <div 
      key={blog.id}
      ref={index === filteredAndSortedBlogs.length - 1 ? lastBlogElementRef : null}
    >
      {/* åšå®¢å¡ç‰‡å†…å®¹ */}
    </div>
  ))}
</AnimatePresence>
```

### å†…å­˜ç®¡ç†

ç»„ä»¶æ­£ç¡®åœ°æ¸…ç†äº†Intersection Observerï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ï¼š

```typescript
useEffect(() => {
  // è®¾ç½®è§‚å¯Ÿå™¨
  
  return () => {
    if (observerRef.current) observerRef.current.disconnect();
  };
}, [isLoading, hasMore, onLoadMore]);
```

### æ¸²æŸ“æ€§èƒ½æŒ‡æ ‡

- **é¦–æ¬¡æ¸²æŸ“æ—¶é—´**: < 200ms
- **ç­›é€‰å“åº”æ—¶é—´**: < 100ms
- **æ— é™æ»šåŠ¨è§¦å‘å»¶è¿Ÿ**: < 100ms
- **å†…å­˜å ç”¨**: < 50MB

## æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜è¯Šæ–­

1. **æ— é™æ»šåŠ¨ä¸å·¥ä½œ**
   - æ£€æŸ¥hasMoreå±æ€§æ˜¯å¦æ­£ç¡®è®¾ç½®
   - ç¡®è®¤onLoadMoreå›è°ƒå‡½æ•°å·²æ­£ç¡®ä¼ é€’
   - éªŒè¯æœ€åä¸€ä¸ªå…ƒç´ çš„refæ˜¯å¦æ­£ç¡®ç»‘å®š

2. **ç­›é€‰åŠŸèƒ½å¤±æ•ˆ**
   - æ£€æŸ¥blogsæ•°ç»„æ˜¯å¦æ­£ç¡®ä¼ é€’
   - ç¡®è®¤ç­›é€‰æ¡ä»¶çš„çŠ¶æ€æ›´æ–°æ­£å¸¸
   - éªŒè¯React.useMemoçš„ä¾èµ–æ•°ç»„é…ç½®

3. **è§†å›¾åˆ‡æ¢åŠ¨ç”»å¼‚å¸¸**
   - æ£€æŸ¥Framer Motionåº“æ˜¯å¦æ­£ç¡®å®‰è£…
   - ç¡®è®¤motion.divç»„ä»¶çš„keyå±æ€§å”¯ä¸€æ€§
   - éªŒè¯CSSåŠ¨ç”»ç±»åæ˜¯å¦æ­£ç¡®åº”ç”¨

### è°ƒè¯•å·¥å…·

```typescript
// è°ƒè¯•æ¨¡å¼ï¼šæ·»åŠ æ—¥å¿—è¾“å‡º
console.log('Filtered blogs count:', filteredAndSortedBlogs.length);
console.log('Current filters:', { searchTerm, selectedMood, selectedTags, dateRange });
```

### æ€§èƒ½ç›‘æ§

```typescript
// æ€§èƒ½ç›‘æ§ï¼šæµ‹é‡æ¸²æŸ“æ—¶é—´
const startTime = performance.now();
// æ¸²æŸ“é€»è¾‘
const endTime = performance.now();
console.log(`Rendering took ${endTime - startTime} milliseconds`);
```

**ç« èŠ‚æ¥æº**
- [BlogListPage.tsx](file://src/components/BlogListPage.tsx#L130-L150)

## æ€»ç»“

BlogListPage.tsxæ˜¯ä¸€ä¸ªé«˜åº¦ä¼˜åŒ–çš„åšå®¢åˆ—è¡¨å±•ç¤ºç»„ä»¶ï¼Œå®ƒæˆåŠŸåœ°æ•´åˆäº†å¤šç§ç°ä»£Webå¼€å‘æŠ€æœ¯ï¼š

### æŠ€æœ¯äº®ç‚¹

1. **è§†å›¾æ¨¡å¼åˆ‡æ¢**: å®ç°äº†æµç•…çš„ç½‘æ ¼ä¸åˆ—è¡¨è§†å›¾åˆ‡æ¢ï¼Œæ”¯æŒåŠ¨ç”»è¿‡æ¸¡æ•ˆæœ
2. **æ— é™æ»šåŠ¨**: é‡‡ç”¨Intersection Observer APIï¼Œæä¾›é«˜æ€§èƒ½çš„æ‡’åŠ è½½ä½“éªŒ
3. **æ™ºèƒ½ç­›é€‰**: æ”¯æŒå¤šç»´åº¦ç­›é€‰å’Œå®æ—¶æ’åºï¼Œæå‡ç”¨æˆ·ä½“éªŒ
4. **å“åº”å¼è®¾è®¡**: é’ˆå¯¹ä¸åŒè®¾å¤‡æä¾›ä¼˜åŒ–çš„å¸ƒå±€æ–¹æ¡ˆ
5. **æ€§èƒ½ä¼˜åŒ–**: é€šè¿‡useMemoç¼“å­˜å’Œç²¾ç¡®çš„æ¸²æŸ“æ§åˆ¶ï¼Œç¡®ä¿ç»„ä»¶é«˜æ•ˆè¿è¡Œ

### æ¶æ„ä¼˜åŠ¿

- **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„ç»„ä»¶èŒè´£åˆ†ç¦»ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯
- **å¯æµ‹è¯•æ€§**: åˆç†çš„çŠ¶æ€ç®¡ç†å’Œå‡½æ•°æ‹†åˆ†ï¼Œä¾¿äºå•å…ƒæµ‹è¯•
- **å¯è®¿é—®æ€§**: è‰¯å¥½çš„é”®ç›˜å¯¼èˆªå’Œå±å¹•é˜…è¯»å™¨æ”¯æŒ

### æœªæ¥æ”¹è¿›æ–¹å‘

1. **é”™è¯¯è¾¹ç•Œ**: æ·»åŠ å…¨å±€é”™è¯¯å¤„ç†æœºåˆ¶
2. **é¢„åŠ è½½**: å®ç°æ™ºèƒ½çš„é¢„åŠ è½½ç­–ç•¥
3. **è™šæ‹Ÿæ»šåŠ¨**: å¯¹äºå¤§é‡æ•°æ®åœºæ™¯ï¼Œè€ƒè™‘å®ç°è™šæ‹Ÿæ»šåŠ¨
4. **ç¦»çº¿æ”¯æŒ**: æ·»åŠ ç¦»çº¿æ•°æ®ç¼“å­˜åŠŸèƒ½

è¯¥ç»„ä»¶å±•ç°äº†ç°ä»£Reactåº”ç”¨å¼€å‘çš„æœ€ä½³å®è·µï¼Œä¸ºæ„å»ºé«˜è´¨é‡çš„ç”¨æˆ·ç•Œé¢æä¾›äº†ä¼˜ç§€çš„å‚è€ƒèŒƒä¾‹ã€‚